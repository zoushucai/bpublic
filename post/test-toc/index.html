<!DOCTYPE html>
<html>

<head>
    <meta http-equiv="content-type" content="text/html; charset=utf-8">
    
    <meta http-equiv="content-language" content="zh-CN" />
    

    
    <meta name="viewport" content="width=device-width, initial-scale=0.5">
    

    
    <title>R计算微积分</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.8/clipboard.min.js"></script>
    
    
    
    
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@3.3.7/dist/css/bootstrap.min.css">

    
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@3.3.7/dist/css/bootstrap-theme.min.css">

    <link rel="stylesheet" href="/css/stylesheet.css">
    <link rel="stylesheet" href="/css/home.css">

    
    
        <style type="text/css">
        body { background-color: #fbf6ec;}
        </style>
    
    
                
        
        
            <link rel="stylesheet" href="/css/main.css"/>
        




        
        
        
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.3.2/styles/github.min.css"  />
         
        
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.3.2/highlight.min.js"></script>
        
        
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.3.2/languages/r.min.js"></script>
        
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.3.2/languages/yaml.min.js"></script>
        
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.3.2/languages/latex.min.js"></script>
        
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.3.2/languages/matlab.min.js"></script>
        
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.3.2/languages/mathematica.min.js"></script>
        
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.3.2/languages/julia.min.js"></script>
        
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.3.2/languages/julia-repl.min.js"></script>
        
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.3.2/languages/powershell.min.js"></script>
        
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.3.2/languages/bash.min.js"></script>
        
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.3.2/languages/shell.min.js"></script>
        
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.3.2/languages/python.min.js"></script>
        
        <script>hljs.initHighlightingOnLoad();</script>
     <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
          
     <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.1/css/all.min.css" integrity="sha512-+4zCK9k+qNFUR5X+cKL9EIR+ZOhtIloNl9GIKS57V1MyNsYpYcUrUeQc9vNfzsWfV28IaLL3i96P9sdNyeRssA==" crossorigin="anonymous" />
     
     
</head>


<body>
    <script>
        window.addEventListener("resize", resizeThrottler, false);

        var resizeTimeout;
        function resizeThrottler() {
        
        if ( !resizeTimeout ) {
            resizeTimeout = setTimeout(function() {
            resizeTimeout = null;
            actualResizeHandler();
        
            
            }, 66);
        }
        }
        actualResizeHandler()
        function actualResizeHandler() {
                if (/mobile/i.test(navigator.userAgent) || /android/i.test(navigator.userAgent))
                {
                    document.body.classList.add('mobile');
                }else{
                    document.body.classList.remove('mobile');  
                }
    }</script>

    
      
      
            <nav class="navbar navbar-default navbar-static-top" style="opacity: .9" role="navigation">
        <div class="container-fluid">
            
            <div class="navbar-header">
                <button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#bs-example-navbar-collapse-1">

                    <span class="sr-only">Toggle navigation</span>
                    <span class="big-icon icon-bar"></span>
                    <span class="big-icon icon-bar"></span>
                    <span class="big-icon icon-bar"></span>

                </button>
                <a class="navbar-brand" href="/">zsc</a>
            </div>

            <div class="navbar-collapse collapse" id="bs-example-navbar-collapse-1" style="height: auto;">
                <ul class="nav navbar-nav navbar-right" style="font-size: 100%">
                    
                        
                            
                            <li class=""><a href="/about/">About</a></li>
                            
                            <li class=""><a href="/categories/">Categories</a></li>
                            
                            <li class=""><a href="/">Home</a></li>
                            
                            <li class=""><a href="/tags/">Tags</a></li>
                            
                            <li class=""><a href="/issue/">存在的问题</a></li>
                            
                        
                    
                </ul>
            </div>
        </div>
    </nav>










<div class="inner">
    



    <div class="blog-post">
        
                <div>
            <h2 align="center" id = "singe-h2">
                R计算微积分
                <time>
                    <br>
                    <span> 
                        <i class="fa fa-user-edit" style="color:#888;font-size: 80%;"></i>
                        zsc 
                    </span>
                    &nbsp 
                    <span>                 
                        <i class="fa fa-calendar-alt" style="color:#888;font-size: 80%;"></i>
                        2018-02-10 
                    </span>
                </time>
                
                
                <div>
                    <ul class="tags">
                        
                        <span>标签:</span>
                        <li><a class="link" href="/tags/r"> #r </a></li><li><a class="link" href="/tags/%e7%ac%a6%e5%8f%b7%e8%ae%a1%e7%ae%97"> #符号计算 </a></li><li><a class="link" href="/tags/%e5%be%ae%e7%a7%af%e5%88%86"> #微积分 </a></li>
                        
                        <span> </span>
                        
                    </ul>
                    
                </div>
            </h2>
        </div>
    
        
        <section id="content">
            
<script src="2018-02-10-R计算微积分_files/header-attrs/header-attrs.js"></script>


<div id="一r-计算微积分" class="section level1">
<h1>(一)R 计算微积分</h1>
<div id="差分" class="section level3">
<h3>1.1差分</h3>
<pre class="r"><code>x=1:12
diff(x)  #向量差分  后面一个数减去前面一个数</code></pre>
<pre><code>##  [1] 1 1 1 1 1 1 1 1 1 1 1</code></pre>
<pre class="r"><code>z=matrix(x,3,4)
z</code></pre>
<pre><code>##      [,1] [,2] [,3] [,4]
## [1,]    1    4    7   10
## [2,]    2    5    8   11
## [3,]    3    6    9   12</code></pre>
<pre class="r"><code>diff(z) #矩阵差分 前行减去后行</code></pre>
<pre><code>##      [,1] [,2] [,3] [,4]
## [1,]    1    1    1    1
## [2,]    1    1    1    1</code></pre>
</div>
<div id="符号计算微分" class="section level3">
<h3>1.2 符号计算–微分</h3>
<div id="求一元函数导数-sinx-的一阶导数为-cosx" class="section level5">
<h5>1.2.1求一元函数导数— <span class="math inline">\(\sin{x}\)</span> 的一阶导数为： <span class="math inline">\(\cos{x}\)</span></h5>
<p>在R里，声明表达式对象使用 expression() 函数, 计算一阶导数用D()函数,格式：D(表达式,对谁求导)</p>
<pre class="r"><code>fun=expression(sin(x))# 声明表达式
D(fun,&quot;x&quot;)#---方法1</code></pre>
<pre><code>## cos(x)</code></pre>
<pre class="r"><code>deriv(fun,&quot;x&quot;)#---方法2  其中.grad[, &quot;x&quot;]为求x的导数表达式</code></pre>
<pre><code>## expression({
##     .value &lt;- sin(x)
##     .grad &lt;- array(0, c(length(.value), 1L), list(NULL, c(&quot;x&quot;)))
##     .grad[, &quot;x&quot;] &lt;- cos(x)
##     attr(.value, &quot;gradient&quot;) &lt;- .grad
##     .value
## })</code></pre>
<pre class="r"><code>deriv3(fun,&quot;x&quot;)#---方法3 其中.grad[, &quot;x&quot;]为求x的导数表达式</code></pre>
<pre><code>## expression({
##     .expr1 &lt;- sin(x)
##     .value &lt;- .expr1
##     .grad &lt;- array(0, c(length(.value), 1L), list(NULL, c(&quot;x&quot;)))
##     .hessian &lt;- array(0, c(length(.value), 1L, 1L), list(NULL, 
##         c(&quot;x&quot;), c(&quot;x&quot;)))
##     .grad[, &quot;x&quot;] &lt;- cos(x)
##     .hessian[, &quot;x&quot;, &quot;x&quot;] &lt;- -.expr1
##     attr(.value, &quot;gradient&quot;) &lt;- .grad
##     attr(.value, &quot;hessian&quot;) &lt;- .hessian
##     .value
## })</code></pre>
</div>
<div id="计算n阶导数" class="section level5">
<h5>1.2.2 计算n阶导数</h5>
<ol style="list-style-type: decimal">
<li><p>计算n阶导数—方法一: 结合一阶导数写递归函数</p>
<p>函数： <span class="math inline">\(\sin{x}+\cos{2x}+x^2+xy+y^2+2x^3+y^3\)</span> 的3阶导数为：<span class="math inline">\(12 + 8\sin{2x} -\cos{x}\)</span></p></li>
</ol>
<pre class="r"><code>   fun=expression(sin(x)+cos(2*x)+x^2+x*y+y^2+2*x^3+y^3)
   DD &lt;- function(expr, name, order = 1) {
     if (order &lt; 1)
       stop(&quot;&#39;order&#39; must be &gt;= 1&quot;)
     if (order == 1){
       D(expr, name)
     }else{
       DD(D(expr, name), name, order - 1)
     }
   }
   DD(fun,&quot;x&quot;,3)</code></pre>
<pre><code>## 2 * (3 * 2) - (cos(x) - sin(2 * x) * 2 * 2 * 2)</code></pre>
<ol start="2" style="list-style-type: decimal">
<li>计算n阶导数—方法二: Deriv 包中Simplify()化简表达式</li>
</ol>
<pre class="r"><code>   library(Deriv)
   DD(fun,&quot;x&quot;,3)</code></pre>
<pre><code>## 2 * (3 * 2) - (cos(x) - sin(2 * x) * 2 * 2 * 2)</code></pre>
<pre class="r"><code>   Simplify(DD(fun, &quot;x&quot;, 3))</code></pre>
<pre><code>## 12 + 8 * sin(2 * x) - cos(x)</code></pre>
</div>
<div id="通过函数计算导数" class="section level5">
<h5>1.2.3 通过函数计算导数</h5>
<p>有时候我们有的就是函数，这怎么计算导数呢？—还是用上面的函数</p>
<pre class="r"><code>f=function(x,y)sin(x)+cos(2*x)+x^2+x*y+y^2+2*x^3+y^3 #这里是函数，而不是表达式
body(f)</code></pre>
<pre><code>## sin(x) + cos(2 * x) + x^2 + x * y + y^2 + 2 * x^3 + y^3</code></pre>
<pre class="r"><code>Simplify(D(body(f), &quot;x&quot;))# 注意：函数体有花括号{}会出错</code></pre>
<pre><code>## cos(x) + x * (2 + 6 * x) + y - 2 * sin(2 * x)</code></pre>
</div>
<div id="求二元函数偏导数及梯度" class="section level5">
<h5>1.2.4 求二元函数偏导数及梯度</h5>
<pre class="r"><code>D(expression(x^2+x*y+y^2),&quot;x&quot;)# x偏导数</code></pre>
<pre><code>## 2 * x + y</code></pre>
<pre class="r"><code>D(expression(x^2+x*y+y^2),&quot;y&quot;)# y偏导数</code></pre>
<pre><code>## x + 2 * y</code></pre>
</div>
<div id="符号计算扩展包-ryacas" class="section level5">
<h5>1.2.5 符号计算扩展包 Ryacas</h5>
<p>想要做更多的符号计算内容，如解方程，泰勒展开等，可以借助第三方 R 扩展包 Ryacas</p>
<p>解方程: <span class="math inline">\(\frac{x}{1+x}=a\)</span> 求解<span class="math inline">\(x=\frac{a}{1-a}\)</span></p>
<pre class="r"><code>library(Ryacas)
ysym(&quot;Solve(x/(1+x) == a, x)&quot;) </code></pre>
<pre><code>## {x==a/(1-a)}</code></pre>
<p>多项式展开：如<span class="math inline">\((1+x)^3\)</span> 展开</p>
<pre class="r"><code>ysym(expression(Expand((1 + x)^3)))# 把(1+x)^3展开</code></pre>
<pre><code>## y: x^3+3*x^2+3*x+1</code></pre>
<p>求解常微分方程：<span class="math inline">\(y&#39;&#39;=4y\)</span></p>
<pre class="r"><code>ysym(&quot;OdeSolve(y&#39;&#39;== 4 * y)&quot;)</code></pre>
<pre><code>## y: C105*Exp(2*x)+C109*Exp((-2)*x)</code></pre>
<p>泰勒展开：<span class="math inline">\(\cos{x}=1-\frac{1}{2!}x^2+\frac{1}{4!}x^4+o(x^4)\)</span></p>
<pre class="r"><code>ysym(&quot;Taylor(x, a, 3) cos(x)&quot;) # cos(x)函数在a点的3阶泰勒展开</code></pre>
<pre><code>## y: cos(a)+(Deriv(a)cos(a))*(x-a)+((x-a)^2*(Deriv(a)Deriv(a)cos(a)))/2+((x-a)^3*(Deriv(a)Deriv(a)Deriv(a)cos(a)))/6</code></pre>
</div>
<div id="表达式转为函数值" class="section level5">
<h5>1.3 表达式转为函数值</h5>
<p>很多时候我们使用 R 目的是计算，符号计算后希望可以直接代入计算，那么只需要在 deriv 中指定 function.arg 参数为 TRUE。
<span class="math display">\[
\sin{x}+\cos{2x}+x^2+xy+y^2对x求偏导为：\cos{x}-2sin{2x}+2x+y
\]</span></p>
<pre class="r"><code>fun=expression(sin(x)+cos(2*x)+x^2+x*y+y^2)
dx=D(fun,&quot;x&quot;) #用D()函数得到符号运算结果，然后代入数值即可得到最后结果
dx</code></pre>
<pre><code>## cos(x) - sin(2 * x) * 2 + 2 * x + y</code></pre>
<pre class="r"><code>x=0;y=pi# 对x、y赋值
eval(dx)#求出数值解</code></pre>
<pre><code>## [1] 4.141593</code></pre>
<pre class="r"><code>Dfun=deriv(fun,c(&quot;x&quot;,&quot;y&quot;),function.arg = TRUE)# 同时对x、y求偏导--D()函数不可以同时求偏导
Dfun(x=0,y=pi/2) # 代值计算，其中attr(,&quot;gradient&quot;)的值为导数值 ，另一个为原函数在该处的函数值</code></pre>
<pre><code>## [1] 3.467401
## attr(,&quot;gradient&quot;)
##             x        y
## [1,] 2.570796 3.141593</code></pre>
<pre class="r"><code>#我们可以作如下简单验证：
fun=function(x,y){sin(x)+cos(2*x)+x^2+x*y+y^2}
fun(x=0,y=pi/2)</code></pre>
<pre><code>## [1] 3.467401</code></pre>
</div>
</div>
<div id="求积分暂时只找到数值计算的没找到符号计算的" class="section level3">
<h3>1.3、求积分—暂时只找到数值计算的–没找到符号计算的</h3>
<p>积分函数： <code>integrate(fun,a,b)</code> fun被积函数，不需要表达式，因为这是数值计算, a,b为上下限</p>
<pre class="r"><code>f &lt;- function (x) sin(x)
integrate(f,0,pi/2)</code></pre>
<pre><code>## 1 with absolute error &lt; 1.1e-14</code></pre>
<p>有些时候只想要值输入 <code>integrate(f,0,1)$value</code></p>
<pre class="r"><code>integrate(f,0,pi/2)$value</code></pre>
<pre><code>## [1] 1</code></pre>
<pre class="r"><code>sessionInfo()</code></pre>
<pre><code>## R version 4.0.2 (2020-06-22)
## Platform: x86_64-apple-darwin17.0 (64-bit)
## Running under: macOS Mojave 10.14.5
## 
## Matrix products: default
## BLAS:   /Library/Frameworks/R.framework/Versions/4.0/Resources/lib/libRblas.dylib
## LAPACK: /Library/Frameworks/R.framework/Versions/4.0/Resources/lib/libRlapack.dylib
## 
## locale:
## [1] zh_CN.UTF-8/zh_CN.UTF-8/zh_CN.UTF-8/C/zh_CN.UTF-8/zh_CN.UTF-8
## 
## attached base packages:
## [1] stats     graphics  grDevices utils     datasets  methods   base     
## 
## other attached packages:
## [1] Ryacas_1.1.3 Deriv_4.0.1 
## 
## loaded via a namespace (and not attached):
##  [1] Rcpp_1.0.5       bookdown_0.20    rprojroot_1.3-2  crayon_1.3.4    
##  [5] assertthat_0.2.1 withr_2.2.0      digest_0.6.25    R6_2.4.1        
##  [9] backports_1.1.8  magrittr_1.5     evaluate_0.14    blogdown_0.20   
## [13] rlang_0.4.7      stringi_1.4.6    testthat_2.3.2   rmarkdown_2.3   
## [17] desc_1.2.0       tools_4.0.2      stringr_1.4.0    pkgload_1.1.0   
## [21] xfun_0.17        yaml_2.2.1       compiler_4.0.2   htmltools_0.5.0 
## [25] knitr_1.29</code></pre>
</div>
</div>

        </section>
    </div>
    <br>
    
    




<span id="/post/test-toc/" class="leancloud_visitors" data-flag-title="R计算微积分">
  <span class="post-meta-item-text">文章总阅读量 </span>
  <span class="leancloud-visitors-count"><i class="leancloud-visitors-count"></i></span>次;
  <p></p>
</span>



    

    
    
    <button id="edit-button" class="icon-button" type="button" title="Fork and edit" aria-label="Fork and edit" aria-haspopup="true" aria-expanded="false" aria-controls="edit">
        <i class="fa fa-edit">编辑本文</i>
    </button>
    
    
    

    <br>
    <hr>
    <li style="float:left;list-style:none">
        
        <a class="previous" href="/post/2018-01-14-factor/"> 上一篇: 因子数据类型处理</a>
        
    </li>
    <li style="float:right;list-style:none">
        
        <a class="next" href="/post/2018-07-15-%E7%9B%B8%E5%85%B3%E5%9B%BE%E4%B9%8Bggplot%E6%89%A9%E5%B1%952/"> 下一篇: 相关图之ggplot系列扩展2</a>
        
    </li>
     
    
    <script src="/js/copyCode.js"></script>
    <script src="/js/tooltips.js"></script>
    
   
    <script>
    [].slice.call(document.querySelectorAll('table')).forEach(function(el) {
        var wrapper = document.createElement('div');
        wrapper.className = 'table-area';
        el.parentNode.insertBefore(wrapper, el);
        el.parentNode.removeChild(el);
        wrapper.appendChild(el);
        $("table").wrap("<div class='table-area'></div>");
    })
    </script>

    
<br>
<hr>


<!-- Global site tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-111691389-1"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag() { dataLayer.push(arguments); }
  gtag('js', new Date());

  gtag('config', 'UA-111691389-1');
</script>




      
      
      

       
      
      
      <script>
              document.getElementById("edit-button").addEventListener("click", function () {
                  var editWindow = window.open("https:\/\/github.com\/zoushucai\/blogmmm/edit/master/content/post\/2018-02-10-R计算微积分.html");
              });</script>
      
          




<script>
  function resizeIframe(obj) {
    obj.style.height = obj.contentWindow.document.body.scrollHeight + 'px';
  } 
</script>



    </style>
    <script type="text/javascript">
    function showdiv(){
        document.getElementById("divtocTableOfContents").style.display="block";
        document.getElementById("strHref").innerHTML="目录收起-";
        document.getElementById('divTableOfContents').style.width="22%";
        document.getElementById('divTableOfContents').style.height="55%";
        document.getElementById('divTableOfContents').style.top="25%";
        document.getElementById('divTableOfContents').style.bottom="5%";
        document.getElementById("strHref").href="javascript:hidediv()";
    }
    function hidediv(){
        document.getElementById("divtocTableOfContents").style.display="none";
        document.getElementById("strHref").innerHTML="目录展开+";
        document.getElementById("strHref").href="javascript:showdiv()";
        document.getElementById('divTableOfContents').style.width="10%";
        document.getElementById('divTableOfContents').style.height="5%";
    }
    </script>
</body>

</html>
</div> 







    <script defer src="https://cdn.jsdelivr.net/npm/katex@0.12.0/dist/contrib/mathtex-script-type.min.js" integrity="sha384-LJ2FmexL77rmGm6SIpxq7y+XA6bkLzGZEgCywzKOZG/ws4va9fUVu2neMjvc3zdv" crossorigin="anonymous"></script>

    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.12.0/dist/katex.min.css">
    <script defer src="https://cdn.jsdelivr.net/npm/katex@0.12.0/dist/katex.min.js"></script>
    <script defer src="https://cdn.jsdelivr.net/npm/katex@0.12.0/dist/contrib/auto-render.min.js"></script>
    <script>
        document.addEventListener("DOMContentLoaded", function() {
            renderMathInElement(document.body, {
            delimiters: [
                            {left: "$$", right: "$$", display: true},
                            {left: "$", right: "$", display: false},
                            {left: "\\(", right: "\\)", display: false},
                            {left: "\\[", right: "\\]", display: true}
                        ]
            });
        });
    </script>













<br>
<div class="inner">
              
            
          
          
  
          
  
  <div id="vcomments"></div>
  
  <script src="//cdn1.lncld.net/static/js/3.0.4/av-min.js"></script>
  
  <script src='//unpkg.com/valine/dist/Valine.min.js'></script>
  <script type="text/javascript">
    new Valine({
        el: '#vcomments' ,
        appId: 'HfHPKPkLa0cBEDPcdBAHuqMv-gzGzoHsz',
        appKey: 'r5RJAasN8e0mB9sq6y9pEcX0',
        lang:'zh-CN',
        notify:  false , 
        verify:  false  ,
        avatar:'identicon', 
        placeholder: '说点什么吧...',
        visitor:  true 
    });
  </script>

</div>

<br>
<br>
<footer>
    <p style="float:right;margin-right: 5%;margin-top: 0%;">
        &copy; 2021 <a href="https://github.com/zoushucai">zsc</a>
      </p>
</footer>
<br>
<br>


