<!DOCTYPE html>
<html>

<head>
    <meta http-equiv="content-type" content="text/html; charset=utf-8">
    
    <meta http-equiv="content-language" content="zh-CN" />
    

    
    <meta name="viewport" content="width=device-width, initial-scale=0.5">
    

    
    <title>dplyr -- 2实战</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.8/clipboard.min.js"></script>
    
    
    
    
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@3.3.7/dist/css/bootstrap.min.css">

    
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@3.3.7/dist/css/bootstrap-theme.min.css">

    <link rel="stylesheet" href="/css/stylesheet.css">
    <link rel="stylesheet" href="/css/home.css">

    
    
        <style type="text/css">
        body { background-color: #fbf6ec;}
        </style>
    
    
                
        
        
            <link rel="stylesheet" href="/css/main.css"/>
        




        
        
        
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.3.2/styles/github.min.css"  />
         
        
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.3.2/highlight.min.js"></script>
        
        
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.3.2/languages/r.min.js"></script>
        
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.3.2/languages/yaml.min.js"></script>
        
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.3.2/languages/latex.min.js"></script>
        
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.3.2/languages/matlab.min.js"></script>
        
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.3.2/languages/mathematica.min.js"></script>
        
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.3.2/languages/julia.min.js"></script>
        
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.3.2/languages/julia-repl.min.js"></script>
        
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.3.2/languages/powershell.min.js"></script>
        
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.3.2/languages/bash.min.js"></script>
        
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.3.2/languages/shell.min.js"></script>
        
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.3.2/languages/python.min.js"></script>
        
        <script>hljs.initHighlightingOnLoad();</script>
     <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
          
     <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.1/css/all.min.css" integrity="sha512-+4zCK9k+qNFUR5X+cKL9EIR+ZOhtIloNl9GIKS57V1MyNsYpYcUrUeQc9vNfzsWfV28IaLL3i96P9sdNyeRssA==" crossorigin="anonymous" />
     
     
</head>


<body>
    <script>
        window.addEventListener("resize", resizeThrottler, false);

        var resizeTimeout;
        function resizeThrottler() {
        
        if ( !resizeTimeout ) {
            resizeTimeout = setTimeout(function() {
            resizeTimeout = null;
            actualResizeHandler();
        
            
            }, 66);
        }
        }
        actualResizeHandler()
        function actualResizeHandler() {
                if (/mobile/i.test(navigator.userAgent) || /android/i.test(navigator.userAgent))
                {
                    document.body.classList.add('mobile');
                }else{
                    document.body.classList.remove('mobile');  
                }
    }</script>

    
      
      
            <nav class="navbar navbar-default navbar-static-top" style="opacity: .9" role="navigation">
        <div class="container-fluid">
            
            <div class="navbar-header">
                <button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#bs-example-navbar-collapse-1">

                    <span class="sr-only">Toggle navigation</span>
                    <span class="big-icon icon-bar"></span>
                    <span class="big-icon icon-bar"></span>
                    <span class="big-icon icon-bar"></span>

                </button>
                <a class="navbar-brand" href="/">zsc</a>
            </div>

            <div class="navbar-collapse collapse" id="bs-example-navbar-collapse-1" style="height: auto;">
                <ul class="nav navbar-nav navbar-right" style="font-size: 100%">
                    
                        
                            
                            <li class=""><a href="/about/">About</a></li>
                            
                            <li class=""><a href="/categories/">Categories</a></li>
                            
                            <li class=""><a href="/">Home</a></li>
                            
                            <li class=""><a href="/tags/">Tags</a></li>
                            
                            <li class=""><a href="/issue/">存在的问题</a></li>
                            
                        
                    
                </ul>
            </div>
        </div>
    </nav>










<div class="inner">
    



    <div class="blog-post">
        
                <div>
            <h2 align="center" id = "singe-h2">
                dplyr -- 2实战
                <time>
                    <br>
                    <span> 
                        <i class="fa fa-user-edit" style="color:#888;font-size: 80%;"></i>
                        zsc 
                    </span>
                    &nbsp 
                    <span>                 
                        <i class="fa fa-calendar-alt" style="color:#888;font-size: 80%;"></i>
                        2018-01-03 
                    </span>
                </time>
                
                
                <div>
                    <ul class="tags">
                        
                        <span>标签:</span>
                        <li><a class="link" href="/tags/r"> #r </a></li><li><a class="link" href="/tags/dplyr"> #dplyr </a></li>
                        
                        <span> </span>
                        
                    </ul>
                    
                </div>
            </h2>
        </div>
    
        
        <section id="content">
            
<script src="/rmarkdown-libs/header-attrs/header-attrs.js"></script>

<div id="TOC">
<ul>
<li><a href="#选择行filter">1.1、选择行<code>filter()</code></a></li>
<li><a href="#选择列-select">1.2、选择列 <code>select()</code></a></li>
<li><a href="#排序arrange">1.3、排序<code>arrange()</code></a></li>
<li><a href="#添加新变量mutate">1.4、添加新变量<code>mutate</code></a></li>
<li><a href="#汇总行-summarise">1.5 汇总(行): <code>summarise()</code></a></li>
<li><a href="#分组动作">1.6、分组动作</a></li>
</ul>
</div>

<p>把前两天的两篇文章合并，解决方法：名字还是不能太长，在content目录下新建test目录，把它放在content目录下的test目录，不放在post目录，我的test目录只有两篇文章</p>
<div id="选择行filter" class="section level3">
<h3>1.1、选择行<code>filter()</code></h3>
<p>安装<code>nycflights13</code>包，该软件包中的飞机航班数据将用于本文中<code>dplyr</code>包各个函数的演示</p>
<pre class="r"><code>library(dplyr)
library(nycflights13)</code></pre>
<p>函数<code>tbl_df()</code>将过长过大的数据集转换为显示更友好的 tbl_df 类型:</p>
<pre class="r"><code>flights &lt;- tbl_df(flights)
head(flights) #有336,776 x 19</code></pre>
<pre><code>## # A tibble: 6 x 19
##    year month   day dep_time sched_dep_time dep_delay arr_time sched_arr_time
##   &lt;int&gt; &lt;int&gt; &lt;int&gt;    &lt;int&gt;          &lt;int&gt;     &lt;dbl&gt;    &lt;int&gt;          &lt;int&gt;
## 1  2013     1     1      517            515         2      830            819
## 2  2013     1     1      533            529         4      850            830
## 3  2013     1     1      542            540         2      923            850
## 4  2013     1     1      544            545        -1     1004           1022
## 5  2013     1     1      554            600        -6      812            837
## 6  2013     1     1      554            558        -4      740            728
## # … with 11 more variables: arr_delay &lt;dbl&gt;, carrier &lt;chr&gt;, flight &lt;int&gt;,
## #   tailnum &lt;chr&gt;, origin &lt;chr&gt;, dest &lt;chr&gt;, air_time &lt;dbl&gt;, distance &lt;dbl&gt;,
## #   hour &lt;dbl&gt;, minute &lt;dbl&gt;, time_hour &lt;dttm&gt;</code></pre>
<pre class="r"><code>filter(flights,origin == &quot;JFK&quot;,month == 6L) #－ 获取六月份所有从”JFK”机场起飞的航班</code></pre>
<pre><code>## # A tibble: 9,472 x 19
##     year month   day dep_time sched_dep_time dep_delay arr_time sched_arr_time
##    &lt;int&gt; &lt;int&gt; &lt;int&gt;    &lt;int&gt;          &lt;int&gt;     &lt;dbl&gt;    &lt;int&gt;          &lt;int&gt;
##  1  2013     6     1        2           2359         3      341            350
##  2  2013     6     1      538            545        -7      925            922
##  3  2013     6     1      539            540        -1      832            840
##  4  2013     6     1      553            600        -7      700            711
##  5  2013     6     1      554            600        -6      851            908
##  6  2013     6     1      557            600        -3      934            942
##  7  2013     6     1      559            600        -1      856            930
##  8  2013     6     1      606            610        -4      847            906
##  9  2013     6     1      609            615        -6      759            808
## 10  2013     6     1      615            610         5      837            847
## # … with 9,462 more rows, and 11 more variables: arr_delay &lt;dbl&gt;,
## #   carrier &lt;chr&gt;, flight &lt;int&gt;, tailnum &lt;chr&gt;, origin &lt;chr&gt;, dest &lt;chr&gt;,
## #   air_time &lt;dbl&gt;, distance &lt;dbl&gt;, hour &lt;dbl&gt;, minute &lt;dbl&gt;, time_hour &lt;dttm&gt;</code></pre>
<pre class="r"><code>slice(flights,1:2) #选取前面的1:2行</code></pre>
<pre><code>## # A tibble: 2 x 19
##    year month   day dep_time sched_dep_time dep_delay arr_time sched_arr_time
##   &lt;int&gt; &lt;int&gt; &lt;int&gt;    &lt;int&gt;          &lt;int&gt;     &lt;dbl&gt;    &lt;int&gt;          &lt;int&gt;
## 1  2013     1     1      517            515         2      830            819
## 2  2013     1     1      533            529         4      850            830
## # … with 11 more variables: arr_delay &lt;dbl&gt;, carrier &lt;chr&gt;, flight &lt;int&gt;,
## #   tailnum &lt;chr&gt;, origin &lt;chr&gt;, dest &lt;chr&gt;, air_time &lt;dbl&gt;, distance &lt;dbl&gt;,
## #   hour &lt;dbl&gt;, minute &lt;dbl&gt;, time_hour &lt;dttm&gt;</code></pre>
<pre class="r"><code>sample_n(flights, 4, replace = TRUE)# 随机选取4条数据记录。</code></pre>
<pre><code>## # A tibble: 4 x 19
##    year month   day dep_time sched_dep_time dep_delay arr_time sched_arr_time
##   &lt;int&gt; &lt;int&gt; &lt;int&gt;    &lt;int&gt;          &lt;int&gt;     &lt;dbl&gt;    &lt;int&gt;          &lt;int&gt;
## 1  2013     8    22     1857           1705       112     2150           2020
## 2  2013     5    27     1958           1925        33     2152           2129
## 3  2013     9    10     1345           1345         0     1520           1520
## 4  2013    11    21     1058           1100        -2     1311           1304
## # … with 11 more variables: arr_delay &lt;dbl&gt;, carrier &lt;chr&gt;, flight &lt;int&gt;,
## #   tailnum &lt;chr&gt;, origin &lt;chr&gt;, dest &lt;chr&gt;, air_time &lt;dbl&gt;, distance &lt;dbl&gt;,
## #   hour &lt;dbl&gt;, minute &lt;dbl&gt;, time_hour &lt;dttm&gt;</code></pre>
<pre class="r"><code>flights %&gt;% top_n(4,dep_time)</code></pre>
<pre><code>## # A tibble: 29 x 19
##     year month   day dep_time sched_dep_time dep_delay arr_time sched_arr_time
##    &lt;int&gt; &lt;int&gt; &lt;int&gt;    &lt;int&gt;          &lt;int&gt;     &lt;dbl&gt;    &lt;int&gt;          &lt;int&gt;
##  1  2013    10    30     2400           2359         1      327            337
##  2  2013    11    27     2400           2359         1      515            445
##  3  2013    12     5     2400           2359         1      427            440
##  4  2013    12     9     2400           2359         1      432            440
##  5  2013    12     9     2400           2250        70       59           2356
##  6  2013    12    13     2400           2359         1      432            440
##  7  2013    12    19     2400           2359         1      434            440
##  8  2013    12    29     2400           1700       420      302           2025
##  9  2013     2     7     2400           2359         1      432            436
## 10  2013     2     7     2400           2359         1      443            444
## # … with 19 more rows, and 11 more variables: arr_delay &lt;dbl&gt;, carrier &lt;chr&gt;,
## #   flight &lt;int&gt;, tailnum &lt;chr&gt;, origin &lt;chr&gt;, dest &lt;chr&gt;, air_time &lt;dbl&gt;,
## #   distance &lt;dbl&gt;, hour &lt;dbl&gt;, minute &lt;dbl&gt;, time_hour &lt;dttm&gt;</code></pre>
</div>
<div id="选择列-select" class="section level3">
<h3>1.2、选择列 <code>select()</code></h3>
<p>若要对选择的列进行处理用mutate函数，这里只能对列名进行处理.</p>
<pre class="r"><code>ans &lt;- flights %&gt;% select(dep_time,arr_time)
head(ans)</code></pre>
<pre><code>## # A tibble: 6 x 2
##   dep_time arr_time
##      &lt;int&gt;    &lt;int&gt;
## 1      517      830
## 2      533      850
## 3      542      923
## 4      544     1004
## 5      554      812
## 6      554      740</code></pre>
<pre class="r"><code>ans &lt;- flights %&gt;% select(day:arr_delay)
head(ans)</code></pre>
<pre><code>## # A tibble: 6 x 7
##     day dep_time sched_dep_time dep_delay arr_time sched_arr_time arr_delay
##   &lt;int&gt;    &lt;int&gt;          &lt;int&gt;     &lt;dbl&gt;    &lt;int&gt;          &lt;int&gt;     &lt;dbl&gt;
## 1     1      517            515         2      830            819        11
## 2     1      533            529         4      850            830        20
## 3     1      542            540         2      923            850        33
## 4     1      544            545        -1     1004           1022       -18
## 5     1      554            600        -6      812            837       -25
## 6     1      554            558        -4      740            728        12</code></pre>
<pre class="r"><code>#选择整数列,若要对选择的列进行处理用mutate函数，这里只能对列名进行处理，比如
ans &lt;- flights %&gt;% head() %&gt;% select_if(is.integer,toupper)
ans</code></pre>
<pre><code>## # A tibble: 6 x 8
##    YEAR MONTH   DAY DEP_TIME SCHED_DEP_TIME ARR_TIME SCHED_ARR_TIME FLIGHT
##   &lt;int&gt; &lt;int&gt; &lt;int&gt;    &lt;int&gt;          &lt;int&gt;    &lt;int&gt;          &lt;int&gt;  &lt;int&gt;
## 1  2013     1     1      517            515      830            819   1545
## 2  2013     1     1      533            529      850            830   1714
## 3  2013     1     1      542            540      923            850   1141
## 4  2013     1     1      544            545     1004           1022    725
## 5  2013     1     1      554            600      812            837    461
## 6  2013     1     1      554            558      740            728   1696</code></pre>
<pre class="r"><code>#选择是字符串的列
ans &lt;- flights %&gt;% head() %&gt;% select_if(is.character)
ans</code></pre>
<pre><code>## # A tibble: 6 x 4
##   carrier tailnum origin dest 
##   &lt;chr&gt;   &lt;chr&gt;   &lt;chr&gt;  &lt;chr&gt;
## 1 UA      N14228  EWR    IAH  
## 2 UA      N24211  LGA    IAH  
## 3 AA      N619AA  JFK    MIA  
## 4 B6      N804JB  JFK    BQN  
## 5 DL      N668DN  LGA    ATL  
## 6 UA      N39463  EWR    ORD</code></pre>
<p>选择数值列并且以某个字符开始的列</p>
<pre class="r"><code>select_if(iris,is.numeric) %&gt;% select(starts_with(&quot;s&quot;)) %&gt;% head()</code></pre>
<pre><code>##   Sepal.Length Sepal.Width
## 1          5.1         3.5
## 2          4.9         3.0
## 3          4.7         3.2
## 4          4.6         3.1
## 5          5.0         3.6
## 6          5.4         3.9</code></pre>
<p>选择非数值列</p>
<pre class="r"><code># 选择非数值列
## 利用purrr包中的negate函数
library(purrr)
iris %&gt;% select_if(negate(is.numeric)) %&gt;% head()</code></pre>
<pre><code>##   Species
## 1  setosa
## 2  setosa
## 3  setosa
## 4  setosa
## 5  setosa
## 6  setosa</code></pre>
<pre class="r"><code>iris %&gt;% select_if(~!is.numeric(.x)) %&gt;% head()</code></pre>
<pre><code>##   Species
## 1  setosa
## 2  setosa
## 3  setosa
## 4  setosa
## 5  setosa
## 6  setosa</code></pre>
<pre class="r"><code>iris %&gt;% select_if(funs(!is.numeric(.))) %&gt;% head()</code></pre>
<pre><code>##   Species
## 1  setosa
## 2  setosa
## 3  setosa
## 4  setosa
## 5  setosa
## 6  setosa</code></pre>
<pre class="r"><code>iris %&gt;% select_if(~ is.factor(.x)|is.numeric(.x))</code></pre>
<pre><code>##     Sepal.Length Sepal.Width Petal.Length Petal.Width    Species
## 1            5.1         3.5          1.4         0.2     setosa
## 2            4.9         3.0          1.4         0.2     setosa
## 3            4.7         3.2          1.3         0.2     setosa
## 4            4.6         3.1          1.5         0.2     setosa
## 5            5.0         3.6          1.4         0.2     setosa
## 6            5.4         3.9          1.7         0.4     setosa
## 7            4.6         3.4          1.4         0.3     setosa
## 8            5.0         3.4          1.5         0.2     setosa
## 9            4.4         2.9          1.4         0.2     setosa
## 10           4.9         3.1          1.5         0.1     setosa
## 11           5.4         3.7          1.5         0.2     setosa
## 12           4.8         3.4          1.6         0.2     setosa
## 13           4.8         3.0          1.4         0.1     setosa
## 14           4.3         3.0          1.1         0.1     setosa
## 15           5.8         4.0          1.2         0.2     setosa
## 16           5.7         4.4          1.5         0.4     setosa
## 17           5.4         3.9          1.3         0.4     setosa
## 18           5.1         3.5          1.4         0.3     setosa
## 19           5.7         3.8          1.7         0.3     setosa
## 20           5.1         3.8          1.5         0.3     setosa
## 21           5.4         3.4          1.7         0.2     setosa
## 22           5.1         3.7          1.5         0.4     setosa
## 23           4.6         3.6          1.0         0.2     setosa
## 24           5.1         3.3          1.7         0.5     setosa
## 25           4.8         3.4          1.9         0.2     setosa
## 26           5.0         3.0          1.6         0.2     setosa
## 27           5.0         3.4          1.6         0.4     setosa
## 28           5.2         3.5          1.5         0.2     setosa
## 29           5.2         3.4          1.4         0.2     setosa
## 30           4.7         3.2          1.6         0.2     setosa
## 31           4.8         3.1          1.6         0.2     setosa
## 32           5.4         3.4          1.5         0.4     setosa
## 33           5.2         4.1          1.5         0.1     setosa
## 34           5.5         4.2          1.4         0.2     setosa
## 35           4.9         3.1          1.5         0.2     setosa
## 36           5.0         3.2          1.2         0.2     setosa
## 37           5.5         3.5          1.3         0.2     setosa
## 38           4.9         3.6          1.4         0.1     setosa
## 39           4.4         3.0          1.3         0.2     setosa
## 40           5.1         3.4          1.5         0.2     setosa
## 41           5.0         3.5          1.3         0.3     setosa
## 42           4.5         2.3          1.3         0.3     setosa
## 43           4.4         3.2          1.3         0.2     setosa
## 44           5.0         3.5          1.6         0.6     setosa
## 45           5.1         3.8          1.9         0.4     setosa
## 46           4.8         3.0          1.4         0.3     setosa
## 47           5.1         3.8          1.6         0.2     setosa
## 48           4.6         3.2          1.4         0.2     setosa
## 49           5.3         3.7          1.5         0.2     setosa
## 50           5.0         3.3          1.4         0.2     setosa
## 51           7.0         3.2          4.7         1.4 versicolor
## 52           6.4         3.2          4.5         1.5 versicolor
## 53           6.9         3.1          4.9         1.5 versicolor
## 54           5.5         2.3          4.0         1.3 versicolor
## 55           6.5         2.8          4.6         1.5 versicolor
## 56           5.7         2.8          4.5         1.3 versicolor
## 57           6.3         3.3          4.7         1.6 versicolor
## 58           4.9         2.4          3.3         1.0 versicolor
## 59           6.6         2.9          4.6         1.3 versicolor
## 60           5.2         2.7          3.9         1.4 versicolor
## 61           5.0         2.0          3.5         1.0 versicolor
## 62           5.9         3.0          4.2         1.5 versicolor
## 63           6.0         2.2          4.0         1.0 versicolor
## 64           6.1         2.9          4.7         1.4 versicolor
## 65           5.6         2.9          3.6         1.3 versicolor
## 66           6.7         3.1          4.4         1.4 versicolor
## 67           5.6         3.0          4.5         1.5 versicolor
## 68           5.8         2.7          4.1         1.0 versicolor
## 69           6.2         2.2          4.5         1.5 versicolor
## 70           5.6         2.5          3.9         1.1 versicolor
## 71           5.9         3.2          4.8         1.8 versicolor
## 72           6.1         2.8          4.0         1.3 versicolor
## 73           6.3         2.5          4.9         1.5 versicolor
## 74           6.1         2.8          4.7         1.2 versicolor
## 75           6.4         2.9          4.3         1.3 versicolor
## 76           6.6         3.0          4.4         1.4 versicolor
## 77           6.8         2.8          4.8         1.4 versicolor
## 78           6.7         3.0          5.0         1.7 versicolor
## 79           6.0         2.9          4.5         1.5 versicolor
## 80           5.7         2.6          3.5         1.0 versicolor
## 81           5.5         2.4          3.8         1.1 versicolor
## 82           5.5         2.4          3.7         1.0 versicolor
## 83           5.8         2.7          3.9         1.2 versicolor
## 84           6.0         2.7          5.1         1.6 versicolor
## 85           5.4         3.0          4.5         1.5 versicolor
## 86           6.0         3.4          4.5         1.6 versicolor
## 87           6.7         3.1          4.7         1.5 versicolor
## 88           6.3         2.3          4.4         1.3 versicolor
## 89           5.6         3.0          4.1         1.3 versicolor
## 90           5.5         2.5          4.0         1.3 versicolor
## 91           5.5         2.6          4.4         1.2 versicolor
## 92           6.1         3.0          4.6         1.4 versicolor
## 93           5.8         2.6          4.0         1.2 versicolor
## 94           5.0         2.3          3.3         1.0 versicolor
## 95           5.6         2.7          4.2         1.3 versicolor
## 96           5.7         3.0          4.2         1.2 versicolor
## 97           5.7         2.9          4.2         1.3 versicolor
## 98           6.2         2.9          4.3         1.3 versicolor
## 99           5.1         2.5          3.0         1.1 versicolor
## 100          5.7         2.8          4.1         1.3 versicolor
## 101          6.3         3.3          6.0         2.5  virginica
## 102          5.8         2.7          5.1         1.9  virginica
## 103          7.1         3.0          5.9         2.1  virginica
## 104          6.3         2.9          5.6         1.8  virginica
## 105          6.5         3.0          5.8         2.2  virginica
## 106          7.6         3.0          6.6         2.1  virginica
## 107          4.9         2.5          4.5         1.7  virginica
## 108          7.3         2.9          6.3         1.8  virginica
## 109          6.7         2.5          5.8         1.8  virginica
## 110          7.2         3.6          6.1         2.5  virginica
## 111          6.5         3.2          5.1         2.0  virginica
## 112          6.4         2.7          5.3         1.9  virginica
## 113          6.8         3.0          5.5         2.1  virginica
## 114          5.7         2.5          5.0         2.0  virginica
## 115          5.8         2.8          5.1         2.4  virginica
## 116          6.4         3.2          5.3         2.3  virginica
## 117          6.5         3.0          5.5         1.8  virginica
## 118          7.7         3.8          6.7         2.2  virginica
## 119          7.7         2.6          6.9         2.3  virginica
## 120          6.0         2.2          5.0         1.5  virginica
## 121          6.9         3.2          5.7         2.3  virginica
## 122          5.6         2.8          4.9         2.0  virginica
## 123          7.7         2.8          6.7         2.0  virginica
## 124          6.3         2.7          4.9         1.8  virginica
## 125          6.7         3.3          5.7         2.1  virginica
## 126          7.2         3.2          6.0         1.8  virginica
## 127          6.2         2.8          4.8         1.8  virginica
## 128          6.1         3.0          4.9         1.8  virginica
## 129          6.4         2.8          5.6         2.1  virginica
## 130          7.2         3.0          5.8         1.6  virginica
## 131          7.4         2.8          6.1         1.9  virginica
## 132          7.9         3.8          6.4         2.0  virginica
## 133          6.4         2.8          5.6         2.2  virginica
## 134          6.3         2.8          5.1         1.5  virginica
## 135          6.1         2.6          5.6         1.4  virginica
## 136          7.7         3.0          6.1         2.3  virginica
## 137          6.3         3.4          5.6         2.4  virginica
## 138          6.4         3.1          5.5         1.8  virginica
## 139          6.0         3.0          4.8         1.8  virginica
## 140          6.9         3.1          5.4         2.1  virginica
## 141          6.7         3.1          5.6         2.4  virginica
## 142          6.9         3.1          5.1         2.3  virginica
## 143          5.8         2.7          5.1         1.9  virginica
## 144          6.8         3.2          5.9         2.3  virginica
## 145          6.7         3.3          5.7         2.5  virginica
## 146          6.7         3.0          5.2         2.3  virginica
## 147          6.3         2.5          5.0         1.9  virginica
## 148          6.5         3.0          5.2         2.0  virginica
## 149          6.2         3.4          5.4         2.3  virginica
## 150          5.9         3.0          5.1         1.8  virginica</code></pre>
<p>行同时选择——子集</p>
<pre class="r"><code>filter(flights,origin == &quot;JFK&quot;,month == 6L) %&gt;%select(day:arr_delay)</code></pre>
<pre><code>## # A tibble: 9,472 x 7
##      day dep_time sched_dep_time dep_delay arr_time sched_arr_time arr_delay
##    &lt;int&gt;    &lt;int&gt;          &lt;int&gt;     &lt;dbl&gt;    &lt;int&gt;          &lt;int&gt;     &lt;dbl&gt;
##  1     1        2           2359         3      341            350        -9
##  2     1      538            545        -7      925            922         3
##  3     1      539            540        -1      832            840        -8
##  4     1      553            600        -7      700            711       -11
##  5     1      554            600        -6      851            908       -17
##  6     1      557            600        -3      934            942        -8
##  7     1      559            600        -1      856            930       -34
##  8     1      606            610        -4      847            906       -19
##  9     1      609            615        -6      759            808        -9
## 10     1      615            610         5      837            847       -10
## # … with 9,462 more rows</code></pre>
</div>
<div id="排序arrange" class="section level3">
<h3>1.3、排序<code>arrange()</code></h3>
<pre class="r"><code>ans &lt;- arrange(flights,origin,desc(dest))  #对列名加 desc() 进行倒序: 与基本函数order()类似
head(ans)</code></pre>
<pre><code>## # A tibble: 6 x 19
##    year month   day dep_time sched_dep_time dep_delay arr_time sched_arr_time
##   &lt;int&gt; &lt;int&gt; &lt;int&gt;    &lt;int&gt;          &lt;int&gt;     &lt;dbl&gt;    &lt;int&gt;          &lt;int&gt;
## 1  2013     1     2      905            822        43     1313           1045
## 2  2013     1     3      848            850        -2     1149           1113
## 3  2013     1     4      901            850        11     1120           1113
## 4  2013     1     6      843            848        -5     1053           1111
## 5  2013     1     7      858            850         8     1105           1113
## 6  2013     1     8      847            850        -3     1116           1113
## # … with 11 more variables: arr_delay &lt;dbl&gt;, carrier &lt;chr&gt;, flight &lt;int&gt;,
## #   tailnum &lt;chr&gt;, origin &lt;chr&gt;, dest &lt;chr&gt;, air_time &lt;dbl&gt;, distance &lt;dbl&gt;,
## #   hour &lt;dbl&gt;, minute &lt;dbl&gt;, time_hour &lt;dttm&gt;</code></pre>
</div>
<div id="添加新变量mutate" class="section level3">
<h3>1.4、添加新变量<code>mutate</code></h3>
<p>在引用函数是 <code>.funs()</code> 的格式为<code>funs(mean(.))</code> e.g.<code>transmute_if(df,is.integer,funs(as.character(.)))</code></p>
<pre class="r"><code># 添加新变量(可以多列) 
flights %&gt;% mutate(yanwu=arr_delay + dep_delay) %&gt;% head()</code></pre>
<pre><code>## # A tibble: 6 x 20
##    year month   day dep_time sched_dep_time dep_delay arr_time sched_arr_time
##   &lt;int&gt; &lt;int&gt; &lt;int&gt;    &lt;int&gt;          &lt;int&gt;     &lt;dbl&gt;    &lt;int&gt;          &lt;int&gt;
## 1  2013     1     1      517            515         2      830            819
## 2  2013     1     1      533            529         4      850            830
## 3  2013     1     1      542            540         2      923            850
## 4  2013     1     1      544            545        -1     1004           1022
## 5  2013     1     1      554            600        -6      812            837
## 6  2013     1     1      554            558        -4      740            728
## # … with 12 more variables: arr_delay &lt;dbl&gt;, carrier &lt;chr&gt;, flight &lt;int&gt;,
## #   tailnum &lt;chr&gt;, origin &lt;chr&gt;, dest &lt;chr&gt;, air_time &lt;dbl&gt;, distance &lt;dbl&gt;,
## #   hour &lt;dbl&gt;, minute &lt;dbl&gt;, time_hour &lt;dttm&gt;, yanwu &lt;dbl&gt;</code></pre>
<pre class="r"><code>flights %&gt;% transmute(yanwu=arr_delay + dep_delay) %&gt;% head()</code></pre>
<pre><code>## # A tibble: 6 x 1
##   yanwu
##   &lt;dbl&gt;
## 1    13
## 2    24
## 3    35
## 4   -19
## 5   -31
## 6     8</code></pre>
<p>有多少航班完全没有延误</p>
<pre class="r"><code>#有多少航班完全没有延误
flights %&gt;% mutate(yanwu=arr_delay + dep_delay) %&gt;% filter(yanwu&lt;0) %&gt;% head()</code></pre>
<pre><code>## # A tibble: 6 x 20
##    year month   day dep_time sched_dep_time dep_delay arr_time sched_arr_time
##   &lt;int&gt; &lt;int&gt; &lt;int&gt;    &lt;int&gt;          &lt;int&gt;     &lt;dbl&gt;    &lt;int&gt;          &lt;int&gt;
## 1  2013     1     1      544            545        -1     1004           1022
## 2  2013     1     1      554            600        -6      812            837
## 3  2013     1     1      557            600        -3      709            723
## 4  2013     1     1      557            600        -3      838            846
## 5  2013     1     1      558            600        -2      849            851
## 6  2013     1     1      558            600        -2      853            856
## # … with 12 more variables: arr_delay &lt;dbl&gt;, carrier &lt;chr&gt;, flight &lt;int&gt;,
## #   tailnum &lt;chr&gt;, origin &lt;chr&gt;, dest &lt;chr&gt;, air_time &lt;dbl&gt;, distance &lt;dbl&gt;,
## #   hour &lt;dbl&gt;, minute &lt;dbl&gt;, time_hour &lt;dttm&gt;, yanwu &lt;dbl&gt;</code></pre>
<pre class="r"><code>flights %&gt;%head() %&gt;%  transmute_if(is.integer,funs(as.character(.)))  #把整数类型的列转换为字符串  </code></pre>
<pre><code>## # A tibble: 6 x 8
##   year  month day   dep_time sched_dep_time arr_time sched_arr_time flight
##   &lt;chr&gt; &lt;chr&gt; &lt;chr&gt; &lt;chr&gt;    &lt;chr&gt;          &lt;chr&gt;    &lt;chr&gt;          &lt;chr&gt; 
## 1 2013  1     1     517      515            830      819            1545  
## 2 2013  1     1     533      529            850      830            1714  
## 3 2013  1     1     542      540            923      850            1141  
## 4 2013  1     1     544      545            1004     1022           725   
## 5 2013  1     1     554      600            812      837            461   
## 6 2013  1     1     554      558            740      728            1696</code></pre>
<pre class="r"><code>flights </code></pre>
<pre><code>## # A tibble: 336,776 x 19
##     year month   day dep_time sched_dep_time dep_delay arr_time sched_arr_time
##    &lt;int&gt; &lt;int&gt; &lt;int&gt;    &lt;int&gt;          &lt;int&gt;     &lt;dbl&gt;    &lt;int&gt;          &lt;int&gt;
##  1  2013     1     1      517            515         2      830            819
##  2  2013     1     1      533            529         4      850            830
##  3  2013     1     1      542            540         2      923            850
##  4  2013     1     1      544            545        -1     1004           1022
##  5  2013     1     1      554            600        -6      812            837
##  6  2013     1     1      554            558        -4      740            728
##  7  2013     1     1      555            600        -5      913            854
##  8  2013     1     1      557            600        -3      709            723
##  9  2013     1     1      557            600        -3      838            846
## 10  2013     1     1      558            600        -2      753            745
## # … with 336,766 more rows, and 11 more variables: arr_delay &lt;dbl&gt;,
## #   carrier &lt;chr&gt;, flight &lt;int&gt;, tailnum &lt;chr&gt;, origin &lt;chr&gt;, dest &lt;chr&gt;,
## #   air_time &lt;dbl&gt;, distance &lt;dbl&gt;, hour &lt;dbl&gt;, minute &lt;dbl&gt;, time_hour &lt;dttm&gt;</code></pre>
<pre class="r"><code># 可以在同一语句中对刚新增加的列进行操作:
transmute(flights, 
       gain = arr_delay + dep_delay, 
       gain_per_hour = gain / (arr_time / 60))</code></pre>
<pre><code>## # A tibble: 336,776 x 2
##     gain gain_per_hour
##    &lt;dbl&gt;         &lt;dbl&gt;
##  1    13         0.940
##  2    24         1.69 
##  3    35         2.28 
##  4   -19        -1.14 
##  5   -31        -2.29 
##  6     8         0.649
##  7    14         0.920
##  8   -17        -1.44 
##  9   -11        -0.788
## 10     6         0.478
## # … with 336,766 more rows</code></pre>
</div>
<div id="汇总行-summarise" class="section level3">
<h3>1.5 汇总(行): <code>summarise()</code></h3>
<p>对数据框调用其它函数进行汇总操作, 返回一维的结果:先用一个简单的数据集iris</p>
<pre class="r"><code>iris %&gt;% group_by(Species) %&gt;% summarise(mean(Sepal.Length,na.rm = T))</code></pre>
<pre><code>## # A tibble: 3 x 2
##   Species    `mean(Sepal.Length, na.rm = T)`
##   &lt;fct&gt;                                &lt;dbl&gt;
## 1 setosa                                5.01
## 2 versicolor                            5.94
## 3 virginica                             6.59</code></pre>
<pre class="r"><code>iris %&gt;% group_by(Species) %&gt;% summarise_each(funs(mean))</code></pre>
<pre><code>## # A tibble: 3 x 5
##   Species    Sepal.Length Sepal.Width Petal.Length Petal.Width
##   &lt;fct&gt;             &lt;dbl&gt;       &lt;dbl&gt;        &lt;dbl&gt;       &lt;dbl&gt;
## 1 setosa             5.01        3.43         1.46       0.246
## 2 versicolor         5.94        2.77         4.26       1.33 
## 3 virginica          6.59        2.97         5.55       2.03</code></pre>
<pre class="r"><code>iris %&gt;% group_by(Species) %&gt;% summarise_each(funs(min(.),max(.)))</code></pre>
<pre><code>## # A tibble: 3 x 9
##   Species Sepal.Length_min Sepal.Width_min Petal.Length_min Petal.Width_min
##   &lt;fct&gt;              &lt;dbl&gt;           &lt;dbl&gt;            &lt;dbl&gt;           &lt;dbl&gt;
## 1 setosa               4.3             2.3              1               0.1
## 2 versic…              4.9             2                3               1  
## 3 virgin…              4.9             2.2              4.5             1.4
## # … with 4 more variables: Sepal.Length_max &lt;dbl&gt;, Sepal.Width_max &lt;dbl&gt;,
## #   Petal.Length_max &lt;dbl&gt;, Petal.Width_max &lt;dbl&gt;</code></pre>
<pre class="r"><code>iris %&gt;% group_by(Sepal.Width) %&gt;% summarise(f_count=n()) %&gt;% arrange(desc(f_count)) </code></pre>
<pre><code>## # A tibble: 23 x 2
##    Sepal.Width f_count
##          &lt;dbl&gt;   &lt;int&gt;
##  1         3        26
##  2         2.8      14
##  3         3.2      13
##  4         3.4      12
##  5         3.1      11
##  6         2.9      10
##  7         2.7       9
##  8         2.5       8
##  9         3.3       6
## 10         3.5       6
## # … with 13 more rows</code></pre>
<pre class="r"><code>#上述等价iris %&gt;% group_by(Sepal.Width) %&gt;% tally(sort=TRUE)
#tally可以一步完成上述工作，group_by()以后第一次使用tally进行n()操作,再一次就是sum(n) sort=TRUE对结果排序,当等于TRUE是降序
#再次使用tally()就是sum()
iris %&gt;% group_by(Sepal.Width) %&gt;% tally(sort=TRUE)</code></pre>
<pre><code>## # A tibble: 23 x 2
##    Sepal.Width     n
##          &lt;dbl&gt; &lt;int&gt;
##  1         3      26
##  2         2.8    14
##  3         3.2    13
##  4         3.4    12
##  5         3.1    11
##  6         2.9    10
##  7         2.7     9
##  8         2.5     8
##  9         3.3     6
## 10         3.5     6
## # … with 13 more rows</code></pre>
<pre class="r"><code>iris %&gt;% group_by(Sepal.Width) %&gt;% tally(sort=TRUE)%&gt;%tally()</code></pre>
<pre><code>## # A tibble: 1 x 1
##       n
##   &lt;int&gt;
## 1    23</code></pre>
</div>
<div id="分组动作" class="section level3">
<h3>1.6、分组动作</h3>
<p>以上5个函数已经很方便了, 但是当它们跟分组操作这个概念结合起来时, 那才叫真正的强大! 当对数据集通过 <code>group_by()</code>添加了分组信息后,<code>filter()</code>,<code>select（）</code>,<code>mutate()</code>, <code>arrange()</code> 和 <code>summarise()</code> 函数会自动对这些 tbl 类数据执行分组操作 (R语言泛型函数的优势).</p>
<p>例如: 对飞机航班数据按飞机编号 (tailnum) 进行分组, 计算该飞机航班的次数 (count = n()), 平均飞行距离 (dist = mean(distance, na.rm = TRUE)) 和 延时 (delay = mean(arr_delay, na.rm = TRUE))</p>
<pre class="r"><code>ans=flights %&gt;%
        group_by(tailnum) %&gt;%
            summarise(count=n(),dist=mean(distance,na.rm = T),delay=mean(arr_delay,na.rm = T))
ans %&gt;% head()</code></pre>
<pre><code>## # A tibble: 6 x 4
##   tailnum count  dist delay
##   &lt;chr&gt;   &lt;int&gt; &lt;dbl&gt; &lt;dbl&gt;
## 1 D942DN      4  854. 31.5 
## 2 N0EGMQ    371  676.  9.98
## 3 N10156    153  758. 12.7 
## 4 N102UW     48  536.  2.94
## 5 N103US     46  535. -6.93
## 6 N104UW     47  535.  1.80</code></pre>
<pre class="r"><code>ans %&gt;% filter(count&gt;20,dist&lt;2000)</code></pre>
<pre><code>## # A tibble: 2,962 x 4
##    tailnum count  dist  delay
##    &lt;chr&gt;   &lt;int&gt; &lt;dbl&gt;  &lt;dbl&gt;
##  1 N0EGMQ    371  676.  9.98 
##  2 N10156    153  758. 12.7  
##  3 N102UW     48  536.  2.94 
##  4 N103US     46  535. -6.93 
##  5 N104UW     47  535.  1.80 
##  6 N10575    289  520. 20.7  
##  7 N105UW     45  525. -0.267
##  8 N107US     41  529. -5.73 
##  9 N108UW     60  534. -1.25 
## 10 N109UW     48  536. -2.52 
## # … with 2,952 more rows</code></pre>
<pre class="r"><code>#用 ggplot2 包作个图观察一下, 发现飞机延时不延时跟飞行距离没太大相关性:
library(ggplot2)
ggplot(ans, aes(dist, delay)) + geom_point(aes(size = count), alpha = 1/2) + geom_smooth() + scale_size_area()</code></pre>
<p><img src="/post/2018-01-03-dplyrshizhan2_files/figure-html/unnamed-chunk-14-1.png" width="672" /></p>
<pre class="r"><code>sessionInfo()</code></pre>
<pre><code>## R version 4.0.2 (2020-06-22)
## Platform: x86_64-apple-darwin17.0 (64-bit)
## Running under: macOS Mojave 10.14.5
## 
## Matrix products: default
## BLAS:   /Library/Frameworks/R.framework/Versions/4.0/Resources/lib/libRblas.dylib
## LAPACK: /Library/Frameworks/R.framework/Versions/4.0/Resources/lib/libRlapack.dylib
## 
## locale:
## [1] zh_CN.UTF-8/zh_CN.UTF-8/zh_CN.UTF-8/C/zh_CN.UTF-8/zh_CN.UTF-8
## 
## attached base packages:
## [1] stats     graphics  grDevices utils     datasets  methods   base     
## 
## other attached packages:
## [1] ggplot2_3.3.2      purrr_0.3.4        nycflights13_1.0.1 dplyr_1.0.1       
## 
## loaded via a namespace (and not attached):
##  [1] pillar_1.4.6     compiler_4.0.2   tools_4.0.2      digest_0.6.25   
##  [5] evaluate_0.14    lifecycle_0.2.0  tibble_3.0.3     gtable_0.3.0    
##  [9] nlme_3.1-148     lattice_0.20-41  mgcv_1.8-31      pkgconfig_2.0.3 
## [13] rlang_0.4.7      Matrix_1.2-18    cli_2.0.2        yaml_2.2.1      
## [17] blogdown_0.20    xfun_0.17        withr_2.2.0      stringr_1.4.0   
## [21] knitr_1.29       generics_0.0.2   vctrs_0.3.2      grid_4.0.2      
## [25] tidyselect_1.1.0 glue_1.4.1       R6_2.4.1         fansi_0.4.1     
## [29] rmarkdown_2.3    bookdown_0.20    farver_2.0.3     magrittr_1.5    
## [33] scales_1.1.1     ellipsis_0.3.1   htmltools_0.5.0  splines_4.0.2   
## [37] assertthat_0.2.1 colorspace_1.4-1 labeling_0.3     utf8_1.1.4      
## [41] stringi_1.4.6    munsell_0.5.0    crayon_1.3.4</code></pre>
</div>

        </section>
    </div>
    <br>
    
    




<span id="/post/2018-01-03-dplyrshizhan2/" class="leancloud_visitors" data-flag-title="dplyr -- 2实战">
  <span class="post-meta-item-text">文章总阅读量 </span>
  <span class="leancloud-visitors-count"><i class="leancloud-visitors-count"></i></span>次;
  <p></p>
</span>



    

    
    
    <button id="edit-button" class="icon-button" type="button" title="Fork and edit" aria-label="Fork and edit" aria-haspopup="true" aria-expanded="false" aria-controls="edit">
        <i class="fa fa-edit">编辑本文</i>
    </button>
    
    
    

    <br>
    <hr>
    <li style="float:left;list-style:none">
        
        <a class="previous" href="/post/2017-11-13-%E6%95%B0%E6%8D%AE%E6%A0%87%E5%87%86%E5%8C%96%E6%96%B9%E6%B3%95/"> 上一篇: R语言标准化数据处理</a>
        
    </li>
    <li style="float:right;list-style:none">
        
        <a class="next" href="/post/2018-01-04-dplyr3/"> 下一篇: dplyr -- 3合并数据</a>
        
    </li>
     
    
    <script src="/js/copyCode.js"></script>
    <script src="/js/tooltips.js"></script>
    
   
    <script>
    [].slice.call(document.querySelectorAll('table')).forEach(function(el) {
        var wrapper = document.createElement('div');
        wrapper.className = 'table-area';
        el.parentNode.insertBefore(wrapper, el);
        el.parentNode.removeChild(el);
        wrapper.appendChild(el);
        $("table").wrap("<div class='table-area'></div>");
    })
    </script>

    
<br>
<hr>


<!-- Global site tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-111691389-1"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag() { dataLayer.push(arguments); }
  gtag('js', new Date());

  gtag('config', 'UA-111691389-1');
</script>




      
      
      

       
      
      
      <script>
              document.getElementById("edit-button").addEventListener("click", function () {
                  var editWindow = window.open("https:\/\/github.com\/zoushucai\/blogmmm/edit/master/content/post\/2018-01-03-dplyrshizhan2.html");
              });</script>
      
          




<script>
  function resizeIframe(obj) {
    obj.style.height = obj.contentWindow.document.body.scrollHeight + 'px';
  } 
</script>



    </style>
    <script type="text/javascript">
    function showdiv(){
        document.getElementById("divtocTableOfContents").style.display="block";
        document.getElementById("strHref").innerHTML="目录收起-";
        document.getElementById('divTableOfContents').style.width="22%";
        document.getElementById('divTableOfContents').style.height="55%";
        document.getElementById('divTableOfContents').style.top="25%";
        document.getElementById('divTableOfContents').style.bottom="5%";
        document.getElementById("strHref").href="javascript:hidediv()";
    }
    function hidediv(){
        document.getElementById("divtocTableOfContents").style.display="none";
        document.getElementById("strHref").innerHTML="目录展开+";
        document.getElementById("strHref").href="javascript:showdiv()";
        document.getElementById('divTableOfContents').style.width="10%";
        document.getElementById('divTableOfContents').style.height="5%";
    }
    </script>
</body>

</html>
</div> 







    <script defer src="https://cdn.jsdelivr.net/npm/katex@0.12.0/dist/contrib/mathtex-script-type.min.js" integrity="sha384-LJ2FmexL77rmGm6SIpxq7y+XA6bkLzGZEgCywzKOZG/ws4va9fUVu2neMjvc3zdv" crossorigin="anonymous"></script>

    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.12.0/dist/katex.min.css">
    <script defer src="https://cdn.jsdelivr.net/npm/katex@0.12.0/dist/katex.min.js"></script>
    <script defer src="https://cdn.jsdelivr.net/npm/katex@0.12.0/dist/contrib/auto-render.min.js"></script>
    <script>
        document.addEventListener("DOMContentLoaded", function() {
            renderMathInElement(document.body, {
            delimiters: [
                            {left: "$$", right: "$$", display: true},
                            {left: "$", right: "$", display: false},
                            {left: "\\(", right: "\\)", display: false},
                            {left: "\\[", right: "\\]", display: true}
                        ]
            });
        });
    </script>













<br>
<div class="inner">
              
            
          
          
  
          
  
  <div id="vcomments"></div>
  
  <script src="//cdn1.lncld.net/static/js/3.0.4/av-min.js"></script>
  
  <script src='//unpkg.com/valine/dist/Valine.min.js'></script>
  <script type="text/javascript">
    new Valine({
        el: '#vcomments' ,
        appId: 'HfHPKPkLa0cBEDPcdBAHuqMv-gzGzoHsz',
        appKey: 'r5RJAasN8e0mB9sq6y9pEcX0',
        lang:'zh-CN',
        notify:  false , 
        verify:  false  ,
        avatar:'identicon', 
        placeholder: '说点什么吧...',
        visitor:  true 
    });
  </script>

</div>

<br>
<br>
<footer>
    <p style="float:right;margin-right: 5%;margin-top: 0%;">
        &copy; 2022 <a href="https://github.com/zoushucai">zsc</a>
      </p>
</footer>
<br>
<br>


