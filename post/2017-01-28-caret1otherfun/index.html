<!DOCTYPE html>
<html>

<head>
    <meta http-equiv="content-type" content="text/html; charset=utf-8">
    
    <meta http-equiv="content-language" content="zh-CN" />
    

    
    <meta name="viewport" content="width=device-width, initial-scale=0.5">
    

    
    <title>2、caret包其他函数介绍</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.8/clipboard.min.js"></script>
    
    
    
    
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@3.3.7/dist/css/bootstrap.min.css">

    
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@3.3.7/dist/css/bootstrap-theme.min.css">

    <link rel="stylesheet" href="/css/stylesheet.css">
    <link rel="stylesheet" href="/css/home.css">

    
    
        <style type="text/css">
        body { background-color: #fbf6ec;}
        </style>
    
    
                
        
        
            <link rel="stylesheet" href="/css/main.css"/>
        




        
        
        
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.3.2/styles/github.min.css"  />
         
        
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.3.2/highlight.min.js"></script>
        
        
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.3.2/languages/r.min.js"></script>
        
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.3.2/languages/yaml.min.js"></script>
        
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.3.2/languages/latex.min.js"></script>
        
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.3.2/languages/matlab.min.js"></script>
        
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.3.2/languages/mathematica.min.js"></script>
        
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.3.2/languages/julia.min.js"></script>
        
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.3.2/languages/julia-repl.min.js"></script>
        
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.3.2/languages/powershell.min.js"></script>
        
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.3.2/languages/bash.min.js"></script>
        
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.3.2/languages/shell.min.js"></script>
        
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.3.2/languages/python.min.js"></script>
        
        <script>hljs.initHighlightingOnLoad();</script>
     <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
          
     <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.1/css/all.min.css" integrity="sha512-+4zCK9k+qNFUR5X+cKL9EIR+ZOhtIloNl9GIKS57V1MyNsYpYcUrUeQc9vNfzsWfV28IaLL3i96P9sdNyeRssA==" crossorigin="anonymous" />
     
     
</head>


<body>
    <script>
        window.addEventListener("resize", resizeThrottler, false);

        var resizeTimeout;
        function resizeThrottler() {
        
        if ( !resizeTimeout ) {
            resizeTimeout = setTimeout(function() {
            resizeTimeout = null;
            actualResizeHandler();
        
            
            }, 66);
        }
        }
        actualResizeHandler()
        function actualResizeHandler() {
                if (/mobile/i.test(navigator.userAgent) || /android/i.test(navigator.userAgent))
                {
                    document.body.classList.add('mobile');
                }else{
                    document.body.classList.remove('mobile');  
                }
    }</script>

    
      
      
            <nav class="navbar navbar-default navbar-static-top" style="opacity: .9" role="navigation">
        <div class="container-fluid">
            
            <div class="navbar-header">
                <button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#bs-example-navbar-collapse-1">

                    <span class="sr-only">Toggle navigation</span>
                    <span class="big-icon icon-bar"></span>
                    <span class="big-icon icon-bar"></span>
                    <span class="big-icon icon-bar"></span>

                </button>
                <a class="navbar-brand" href="/">zsc</a>
            </div>

            <div class="navbar-collapse collapse" id="bs-example-navbar-collapse-1" style="height: auto;">
                <ul class="nav navbar-nav navbar-right" style="font-size: 100%">
                    
                        
                            
                            <li class=""><a href="/about/">About</a></li>
                            
                            <li class=""><a href="/categories/">Categories</a></li>
                            
                            <li class=""><a href="/">Home</a></li>
                            
                            <li class=""><a href="/tags/">Tags</a></li>
                            
                            <li class=""><a href="/issue/">存在的问题</a></li>
                            
                        
                    
                </ul>
            </div>
        </div>
    </nav>










<div class="inner">
    



    <div class="blog-post">
        
                <div>
            <h2 align="center" id = "singe-h2">
                2、caret包其他函数介绍
                <time>
                    <br>
                    <span> 
                        <i class="fa fa-user-edit" style="color:#888;font-size: 80%;"></i>
                        zsc 
                    </span>
                    &nbsp 
                    <span>                 
                        <i class="fa fa-calendar-alt" style="color:#888;font-size: 80%;"></i>
                        2017-01-28 
                    </span>
                </time>
                
                
                <div>
                    <ul class="tags">
                        
                        <span>标签:</span>
                        <li><a class="link" href="/tags/r"> #r </a></li><li><a class="link" href="/tags/carte"> #carte </a></li>
                        
                        <span> </span>
                        
                    </ul>
                    
                </div>
            </h2>
        </div>
    
        
        <section id="content">
            
<script src="/rmarkdown-libs/header-attrs/header-attrs.js"></script>


<div id="一创建哑变量" class="section level3">
<h3>一、创建哑变量</h3>
<p>如果你有一个因子型变量需要进行哑变量处理，你会怎么办？也许你会根据该变量的m个水平数构建m-1个哑变量，不错，这样的思路是没有问题的。但如果发现该变量确实很重要，而且水平数目非常多，那你一定会抓狂！<strong>如果你会caret包中的dummyVars()函数</strong>，那将如虎添翼，效率倍增~我们来看看该函数是如何实现哑变量构建的。</p>
<p>函数语法及参数介绍：</p>
<p><code>dummyVars(formula, data, sep = ".",levelsOnly = FALSE, fullRank = FALSE, ...)</code>
<code>predict(object, newdata, na.action = na.pass, ...)</code></p>
<ul>
<li><p><strong>formula:</strong> 公式右边请指定需要处理为哑变量的因子型变量<br />
</p></li>
<li><p><strong>sep:</strong>设置变量与水平间的分割符，默认为实心点。如x.a，x就是变量名,a就是x的一个水平</p></li>
<li><p><strong>levelsOnly:</strong>逻辑值，如果为True，则列名中剔除原变量名。如x.a变为a,把因子作为变量名</p></li>
<li><p><strong>object:</strong>为dummyVars()函数构成的结果</p></li>
<li><p><strong>newdata:</strong>需要处理的新数据</p></li>
<li><p><strong>na.action:</strong>缺失值的对待，变量水平中如果有缺失值，则结果仍为缺失值</p></li>
</ul>
<pre class="r"><code>library(caret)
dummy &lt;- dummyVars(formula = ~ ., data = iris,levelsOnly=TRUE)#把因子作为变量名
pred &lt;- predict(dummy, newdata = iris)
head(pred)</code></pre>
<pre><code>##   Sepal.Length Sepal.Width Petal.Length Petal.Width setosa versicolor virginica
## 1          5.1         3.5          1.4         0.2      1          0         0
## 2          4.9         3.0          1.4         0.2      1          0         0
## 3          4.7         3.2          1.3         0.2      1          0         0
## 4          4.6         3.1          1.5         0.2      1          0         0
## 5          5.0         3.6          1.4         0.2      1          0         0
## 6          5.4         3.9          1.7         0.4      1          0         0</code></pre>
<p>如果有很多因子变量需要转换为哑变量呢？</p>
<pre class="r"><code>set.seed(1234)
f1 &lt;- sample(c(&#39;a&#39;,&#39;b&#39;,&#39;c&#39;),100,replace = T)
f2 &lt;- sample(c(&#39;f&#39;,&#39;m&#39;),100,replace = T)
f3 &lt;- sample(c(&#39;h&#39;,&#39;m&#39;,&#39;l&#39;),100,replace = T)
x &lt;- round(runif(100,1,10))

df &lt;- data.frame(x = x, f1 = f1, f2 = f2, f3 = f3)

#可以直接用下面的方法一步搞定，和上面一样非常方便

dummy=dummyVars(formula = ~.,data=df)#不是因子变量得自动过滤
pred &lt;- predict(dummy, newdata = df)
head(pred)</code></pre>
<pre><code>##    x f1a f1b f1c f2f f2m f3h f3l f3m
## 1  7   0   1   0   0   1   0   0   1
## 2  3   0   1   0   1   0   0   1   0
## 3  8   1   0   0   0   1   0   0   1
## 4  8   0   0   1   1   0   0   1   0
## 5 10   1   0   0   0   1   0   1   0
## 6  3   1   0   0   0   1   0   1   0</code></pre>
</div>
<div id="二近零方差变量的删除" class="section level3">
<h3>二、近零方差变量的删除</h3>
<p>数据集中有某些变量的值非常稀少，而其他值可能又很多，例如性别字段，共有1000个观测，女只有10个观测，男990个观测，<strong>一般直接删除该变量</strong>，若有很多呢？<br />
数语法及参数介绍：</p>
<pre><code>nearZeroVar(x, freqCut = 95/5, uniqueCut = 10, saveMetrics = FALSE, 
                names = FALSE,foreach = FALSE, allowParallel = TRUE)    
nzv(x, freqCut = 95/5, uniqueCut = 10, saveMetrics = FALSE, names = FALSE) </code></pre>
<ul>
<li><p><strong>x:</strong>为一个向量或矩阵或数据框，需要注意的是，必须是数值型对象，</p>
<ul>
<li>如果是字符型的变量，建议转换为数值型的值，可通过factor函数实现<br />
</li>
</ul></li>
<li><p><strong>freqCut:</strong>为一个阈值，默认值为95/5，即最频繁的数值个数除以次频繁的数值个数。</p>
<ul>
<li>如上面的性别字段，990/10&gt;95/5<br />
</li>
</ul></li>
<li><p><strong>uniqueCut:</strong>为一个阈值，默认值为10%，即某个变量中不同值的个数除以样本总量。</p>
<ul>
<li>如上面的性别字段，2/1000&lt;0.1(根据近零方差的判断标准是，如果某个变量的freqCut超过了给到的默认阈值，并且uniqueCut低于给到的默认阈值，就认为改变量是近零方差的。）<br />
</li>
</ul></li>
<li><p><strong>saveMetrics:</strong>逻辑值，默认为False，</p>
<ul>
<li>如果为True的话会返回一个统计表，反映每个变量是否为零方差和近零方差</li>
</ul></li>
<li><p><strong>names:</strong>逻辑值，默认为False，</p>
<ul>
<li>如果为True的话，返回零方差和近零方差的变量名，否则返回对应的索引值<br />
</li>
</ul></li>
<li><p><strong>foreach:</strong>是否指定使用foreach包进行计算，如果使用，计算过程将消耗更少的内存，但会比较耗时间</p></li>
<li><p><strong>allowParallel:</strong>是否指定使用foreach包进行并行运算，如果使用，将会消耗更多内存，但执行时间将更少</p></li>
</ul>
<pre class="r"><code>data(mdrr)# 加载数据mdrr，得到的数据框竟是mdrrDescr
data.frame(table(mdrrDescr$nR11)) #某个变量的观测频率分布</code></pre>
<pre><code>##   Var1 Freq
## 1    0  501
## 2    1    4
## 3    2   23</code></pre>
<pre class="r"><code>dim(mdrrDescr)# 原数据维度</code></pre>
<pre><code>## [1] 528 342</code></pre>
<pre class="r"><code>#方法1
df &lt;- nearZeroVar(mdrrDescr, saveMetrics= TRUE)#得到一个数据框
df[df$nzv,][1:10,]#df$nzv为逻辑值，选择TRUE的，为领方差变量</code></pre>
<pre><code>##        freqRatio percentUnique zeroVar  nzv
## nTB     23.00000     0.3787879   FALSE TRUE
## nBR    131.00000     0.3787879   FALSE TRUE
## nI     527.00000     0.3787879   FALSE TRUE
## nR03   527.00000     0.3787879   FALSE TRUE
## nR08   527.00000     0.3787879   FALSE TRUE
## nR11    21.78261     0.5681818   FALSE TRUE
## nR12    57.66667     0.3787879   FALSE TRUE
## D.Dr03 527.00000     0.3787879   FALSE TRUE
## D.Dr07 123.50000     5.8712121   FALSE TRUE
## D.Dr08 527.00000     0.3787879   FALSE TRUE</code></pre>
<pre class="r"><code>sum(df$nzv)#零方差变量为TURE的个数为45</code></pre>
<pre><code>## [1] 45</code></pre>
<pre class="r"><code>filterdf = mdrrDescr[,!df$nzv] #剔除零方差变量
# 方法2
nzv &lt;- nearZeroVar(mdrrDescr) #直接得到一个向量，零方差变量得序号列
filteredDescr &lt;- mdrrDescr[,-nzv] #剔除零方差变量
dim(filteredDescr) </code></pre>
<pre><code>## [1] 528 297</code></pre>
<pre class="r"><code>all(filterdf==filteredDescr)</code></pre>
<pre><code>## [1] TRUE</code></pre>
<div id="三删除高相关的预测变量和完全线性关系的变量" class="section level4">
<h4>三、删除高相关的预测变量和完全线性关系的变量</h4>
<p>在某些模型算法中就明确要求<strong>变量间不能有高度线性相关的变量</strong>，因为这会导致模型非常敏感与不稳定，例如线性回归模型或基于最小二乘方法的其他模型一般度要求变量间尽量不存在线性相关性。那问题来了，<strong>我该如何检验并剔除高相关的变量呢？</strong></p>
</div>
</div>
<div id="section" class="section level3">
<h3></h3>
<p><code>findCorrelation(x, cutoff = .90, verbose = FALSE,names = FALSE, exact = ncol(x) &lt; 100)</code></p>
<ul>
<li><p><strong>x:</strong>为一个相关系数矩阵</p></li>
<li><p><strong>cutoff:</strong>指定高度线性相关的临界值，默认为0.9</p></li>
<li><p><strong>verbose:</strong>逻辑值，指定是否打印出函数运算的详细结果</p></li>
<li><p><strong>names:</strong>逻辑值，是否返回变量名，默认返回需要删除变量的对应索引值</p></li>
<li><p><strong>exact:</strong>逻辑值，是否重新计算每一步的平均相关系数</p></li>
</ul>
<pre class="r"><code>#返回相关系数矩阵中的上三角值
corr &lt;- cor(iris[,1:4])
corr[upper.tri(corr)]</code></pre>
<pre><code>## [1] -0.1175698  0.8717538 -0.4284401  0.8179411 -0.3661259  0.9628654</code></pre>
<pre class="r"><code>#虽然能够一幕了然的看到那些相关系数是高相关的，但不能明确那组变量间是高相关的。
#
fC = findCorrelation(corr, cutoff = .8)
fC</code></pre>
<pre><code>## [1] 3 4</code></pre>
<pre class="r"><code>head(iris[fC])</code></pre>
<pre><code>##   Petal.Length Petal.Width
## 1          1.4         0.2
## 2          1.4         0.2
## 3          1.3         0.2
## 4          1.5         0.2
## 5          1.4         0.2
## 6          1.7         0.4</code></pre>
<pre class="r"><code>head(iris[-fC])</code></pre>
<pre><code>##   Sepal.Length Sepal.Width Species
## 1          5.1         3.5  setosa
## 2          4.9         3.0  setosa
## 3          4.7         3.2  setosa
## 4          4.6         3.1  setosa
## 5          5.0         3.6  setosa
## 6          5.4         3.9  setosa</code></pre>
</div>
<div id="矩阵的线性相关" class="section level3">
<h3>3.1 矩阵的线性相关</h3>
<pre class="r"><code>ltfrDesign &lt;- matrix(0, nrow=6, ncol=6)
ltfrDesign[,1] &lt;- c(1, 1, 1, 1, 1, 1)
ltfrDesign[,2] &lt;- c(1, 1, 1, 0, 0, 0)
ltfrDesign[,3] &lt;- c(0, 0, 0, 1, 1, 1)
ltfrDesign[,4] &lt;- c(1, 0, 0, 1, 0, 0)
ltfrDesign[,5] &lt;- c(0, 1, 0, 0, 1, 0)
ltfrDesign[,6] &lt;- c(0, 0, 1, 0, 0, 1)


comboInfo &lt;- findLinearCombos(ltfrDesign)#返回一个列表，是列向量的索引
comboInfo</code></pre>
<pre><code>## $linearCombos
## $linearCombos[[1]]
## [1] 3 1 2
## 
## $linearCombos[[2]]
## [1] 6 1 4 5
## 
## 
## $remove
## [1] 3 6</code></pre>
<pre class="r"><code>ltfrDesign[, -comboInfo$remove] #移除线性依赖相关的向量</code></pre>
<pre><code>##      [,1] [,2] [,3] [,4]
## [1,]    1    1    1    0
## [2,]    1    1    0    1
## [3,]    1    1    0    0
## [4,]    1    0    1    0
## [5,]    1    0    0    1
## [6,]    1    0    0    0</code></pre>
</div>
<div id="四数据标准化处理-preprocess函数" class="section level3">
<h3>四、数据标准化处理 preProcess()函数</h3>
<p>参考其他资料，我讲讲其他的</p>
</div>
<div id="五缺失数据的处理" class="section level3">
<h3>五、缺失数据的处理</h3>
<p>　　可以用preProcess()函数，该函数提供了三种缺失值填补的方法，即<strong><font color='red'>K近邻方法、Bagging树集成方法和中位数法</font></strong>。</p>
</div>
<div id="需要注意的是采用k近邻方法时会对原始数据进行标准化如果需要返回原始值还需将标准化公式倒推回来使用bagging树集成方法理论上对缺失值的填补更权威但其效率比较低使用中位数方法速度非常快但填补的准确率有待验证如果你想使用多重插补法不妨也可以试试mice包其操作原理是基于mc蒙特卡洛模拟法" class="section level3">
<h3><strong>需要注意的是，采用K近邻方法时，会对原始数据进行标准化，如果需要返回原始值，还需将标准化公式倒推回来；</strong>使用Bagging树集成方法，理论上对缺失值的填补更权威，但其效率比较低；使用中位数方法，速度非常快，但填补的准确率有待验证。如果你想使用多重插补法，不妨也可以<strong>试试mice包</strong>，其操作原理是基于MC（蒙特卡洛模拟法）。</h3>
<pre class="r"><code>set.seed(1234)
y &lt;- runif(1000,1,10)
x1 &lt;- 2 - 1.32*y + rnorm(1000)
x2 &lt;- 1.3 + 0.8 * y + rnorm(1000)
df &lt;- data.frame(y = y, x1 = x1, x2 = x2)

#对y变量随机构造一些缺失值
df$y[sample(1000,26)] &lt;- NA 
summary(df$y)</code></pre>
<pre><code>##    Min. 1st Qu.  Median    Mean 3rd Qu.    Max.    NA&#39;s 
##   1.003   3.323   5.585   5.564   7.832   9.994      26</code></pre>
<pre class="r"><code>#k临近替补法
imputation_k &lt;- preProcess(df,method = &#39;knnImpute&#39;)
pred_k &lt;- predict(imputation_k, df)
summary(pred_k$y)</code></pre>
<pre><code>##      Min.   1st Qu.    Median      Mean   3rd Qu.      Max. 
## -1.736229 -0.852905  0.010604  0.000577  0.863056  1.686379</code></pre>
<pre class="r"><code>#bagging树替补法
imputation_bag &lt;- preProcess(df,method = &#39;bagImpute&#39;)
pred_bag &lt;- predict(imputation_bag, df)
summary(pred_bag$y)</code></pre>
<pre><code>##    Min. 1st Qu.  Median    Mean 3rd Qu.    Max. 
##   1.003   3.323   5.592   5.566   7.826   9.994</code></pre>
<pre class="r"><code>#中位数替补法
imputation_m &lt;- preProcess(df,method = &#39;medianImpute&#39;)
pred_m &lt;- predict(imputation_m, df)
summary(pred_m$y)</code></pre>
<pre><code>##    Min. 1st Qu.  Median    Mean 3rd Qu.    Max. 
##   1.003   3.379   5.585   5.564   7.774   9.994</code></pre>
</div>
<div id="六变量转换" class="section level3">
<h3>六、变量转换</h3>
<p>　　<strong>preProcess()函数也可以帮助我们实现变量的转换</strong>，例如降维操作，降维的目的是考虑到变量太多，通过降维能使主成分之间不相关或独立，而且还保留了数据绝大部分信息。<strong>我们常见的PCA和ICA就是用于降维，通过设置preProcess()函数的method参数就可方便的实现变量的降维操作。</strong></p>
<p>　　当<strong>method=‘pca’</strong>时，就是指定<strong>主成分分析法</strong>实现数据的降维，原数据集的变量会改为P1，P2…，而且<strong>该方法也会强制原始数据进行标准化处理</strong>；</p>
<p>　　当<strong>method=‘ica’</strong>时，就是指定<strong>独立成分分析法</strong>实现数据的降维，原数据集的变量会改为IC1，IC2，…。 　　</p>
<pre class="r"><code>x1 &lt;- c(5700,1000,3400,3800,4000,8200,1200,9100,9900,9600,9600,9400)
x2 &lt;- c(12.8,10.9,8.8,13.6,12.8,8.3,11.4,11.5,12.5,13.7,9.6,11.4)
x3 &lt;- c(2500,600,1000,1700,1600,2600,400,3300,3400,3600,3300,4000)
x4 &lt;- c(270,10,10,140,140,60,10,60,180,390,80,100)
x5 &lt;- c(25000,10000,9000,25000,25000,12000,16000,14000,18000,25000,12000,13000)
my_data &lt;- data.frame(x1 = x1, x2 = x2, x3 = x3, x4 = x4, x5 = x5)

#pca
pca &lt;- preProcess(my_data, pcaComp = 2, method = &#39;pca&#39;)
pred_pca &lt;- predict(pca, newdata = my_data)
head(pred_pca)</code></pre>
<pre><code>##          PC1        PC2
## 1  1.6436740 -0.9551928
## 2 -2.2569672 -1.0170973
## 3 -2.4952117  0.1203249
## 4  0.7791262 -1.7305754
## 5  0.5644634 -1.5572479
## 6 -1.1730558  1.5417414</code></pre>
<pre class="r"><code>ica &lt;- preProcess(my_data,n.comp= 2, method = &#39;ica&#39;)
pred_ica &lt;- predict(ica, newdata = my_data)
head(pred_ica)</code></pre>
<pre><code>##          ICA1       ICA2
## 1 -0.08532044  1.2539749
## 2 -1.41459576 -0.7490288
## 3 -0.74513359 -1.3481169
## 4 -0.88094458  1.1282154
## 5 -0.83784724  0.9441523
## 6  0.62660219 -1.2542253</code></pre>
</div>
<div id="七数据分割" class="section level3">
<h3>七、数据分割</h3>
<div id="简单的抽样createdatapartition" class="section level4">
<h4>7.1 简单的抽样—createDataPartition()</h4>
<p>函数语法及参数介绍：</p>
<p><code>createDataPartition(y, times = 1, p = 0.5,list = TRUE,groups = min(5, length(y)))</code></p>
<ul>
<li><p><strong>y:</strong> 指定数据集中的输出变量</p></li>
<li><p><strong>times:</strong> 指定创建的样本个数，默认简单随机抽取一组样本</p></li>
<li><p><strong>p:</strong> 指定数据集中用于训练集的比例</p></li>
<li><p><strong>list:</strong> 是否已列表或矩阵的形式存储随机抽取的索引号，默认为TRUE</p></li>
<li><p><strong>groups:</strong> 如果输出变量为数值型数据，则默认按分位数分组进行取样</p></li>
</ul>
<pre class="r"><code>idx2 &lt;- createDataPartition(iris$Species, p = 0.8, list = FALSE)
#设置p=0.8时，就隐含了两层含义，即从总体中抽取80%的样本，同时在各个因子水平下也取80%的样本
train2 &lt;- iris[idx2,]
test2 &lt;- iris[-idx2,]</code></pre>
</div>
<div id="使用有放回的方法进行抽样bootstrap" class="section level4">
<h4>7.2 使用有放回的方法进行抽样（BootStrap)</h4>
<p><code>createResample(y, times = 10, list = TRUE)</code></p>
<ul>
<li><p><strong>y:</strong>指定数据集中的输出变量</p></li>
<li><p><strong>times:</strong>指定抽样组数，默认为10组<br />
</p></li>
<li><p><strong>list:</strong>是否已列表或矩阵的形式存储随机抽取的索引号，默认为TRUE</p></li>
</ul>
<pre class="r"><code>createResample(iris[,5], times = 2, list = TRUE)</code></pre>
<pre><code>## $Resample1
##   [1]   1   3   4   4   5   5   6   7   8   8   9  10  11  13  13  14  16  16
##  [19]  18  20  23  24  24  24  26  26  28  29  31  33  33  34  34  37  37  37
##  [37]  38  42  44  45  47  48  52  54  57  60  61  62  63  63  64  65  66  66
##  [55]  68  69  70  70  71  74  74  74  75  76  76  78  79  80  80  80  83  83
##  [73]  84  87  87  89  89  92  93  93  93  94  95  95  96  96  96  96  97  99
##  [91] 100 100 100 101 101 103 104 106 106 106 107 108 112 112 113 113 113 115
## [109] 116 116 116 116 117 117 117 118 119 121 123 124 125 125 125 126 126 126
## [127] 127 127 128 130 131 132 132 133 134 134 134 135 136 137 137 137 138 138
## [145] 141 144 144 145 148 150
## 
## $Resample2
##   [1]   1   1   1   1   3   4   4   6   6   6   6   6  11  11  14  16  17  18
##  [19]  22  23  24  26  28  29  30  30  30  30  31  31  34  35  36  36  36  38
##  [37]  38  41  42  43  43  44  44  46  47  47  49  51  51  51  51  52  52  53
##  [55]  54  55  55  56  56  60  61  62  62  63  64  66  67  68  69  72  74  74
##  [73]  75  76  77  77  78  80  83  84  85  86  87  87  89  89  89  91  91  92
##  [91]  92  96  96  98  99 100 102 102 102 105 106 106 108 108 109 110 112 114
## [109] 115 115 116 116 116 118 119 121 121 122 122 123 123 125 125 126 127 128
## [127] 128 129 130 131 131 132 132 133 134 134 140 141 141 142 142 143 144 147
## [145] 148 149 150 150 150 150</code></pre>
</div>
<div id="用于交叉验证的样本抽样" class="section level4">
<h4>7.3 用于交叉验证的样本抽样</h4>
<pre><code>createFolds(y, k = 10, list = TRUE, returnTrain = FALSE)
createMultiFolds(y, k = 10, times = 5)</code></pre>
<ul>
<li><p><strong>y:</strong>指定数据集中的输出变量</p></li>
<li><p><strong>k:</strong>指定k重交叉验证的样本，默认为10重。每重的样本量为总量/k。</p></li>
<li><p><strong>list:</strong>是否已列表或矩阵的形式存储随机抽取的索引号，默认为TRUE</p></li>
<li><p><strong>returnTrain:</strong>是否返回抽样的真实值，默认返回样本的索引值</p></li>
<li><p><strong>times:</strong>指定抽样组数，默认为5组（每组中都有10重抽样）</p></li>
</ul>
<pre class="r"><code>createFolds(iris[,5], k = 2, list = TRUE, returnTrain = F)</code></pre>
<pre><code>## $Fold1
##  [1]   5  13  15  16  17  21  22  23  24  26  27  28  29  30  33  34  35  36  43
## [20]  44  45  47  48  49  50  51  52  54  58  59  60  61  62  67  68  69  72  73
## [39]  75  76  80  81  83  86  91  92  93  96  97 100 101 102 109 110 111 112 113
## [58] 117 121 124 126 127 130 132 134 135 136 137 138 139 140 141 143 144 149
## 
## $Fold2
##  [1]   1   2   3   4   6   7   8   9  10  11  12  14  18  19  20  25  31  32  37
## [20]  38  39  40  41  42  46  53  55  56  57  63  64  65  66  70  71  74  77  78
## [39]  79  82  84  85  87  88  89  90  94  95  98  99 103 104 105 106 107 108 114
## [58] 115 116 118 119 120 122 123 125 128 129 131 133 142 145 146 147 148 150</code></pre>
<pre class="r"><code># 产生多个交叉验证的数据指标索引
createMultiFolds(iris[,5], k = 2, times = 2)</code></pre>
<pre><code>## $Fold1.Rep1
##  [1]   1   3   5   6   9  11  13  14  16  18  19  23  25  26  27  31  33  34  36
## [20]  41  42  43  44  45  46  52  53  54  55  56  60  71  72  74  77  80  81  82
## [39]  84  85  86  88  89  90  94  95  96  97  98  99 102 104 105 106 112 113 114
## [58] 117 118 119 120 121 123 125 129 131 132 133 136 138 140 145 146 147 148
## 
## $Fold2.Rep1
##  [1]   2   4   7   8  10  12  15  17  20  21  22  24  28  29  30  32  35  37  38
## [20]  39  40  47  48  49  50  51  57  58  59  61  62  63  64  65  66  67  68  69
## [39]  70  73  75  76  78  79  83  87  91  92  93 100 101 103 107 108 109 110 111
## [58] 115 116 122 124 126 127 128 130 134 135 137 139 141 142 143 144 149 150
## 
## $Fold1.Rep2
##  [1]   1   6   7   8   9  10  12  14  15  16  17  20  21  22  24  25  27  31  37
## [20]  38  40  42  46  47  48  51  52  53  55  57  59  61  63  64  65  67  72  74
## [39]  76  77  78  79  80  81  82  83  89  90  91  93 101 104 106 107 108 110 113
## [58] 114 115 119 121 122 124 129 130 132 133 135 136 138 139 140 143 144 150
## 
## $Fold2.Rep2
##  [1]   2   3   4   5  11  13  18  19  23  26  28  29  30  32  33  34  35  36  39
## [20]  41  43  44  45  49  50  54  56  58  60  62  66  68  69  70  71  73  75  84
## [39]  85  86  87  88  92  94  95  96  97  98  99 100 102 103 105 109 111 112 116
## [58] 117 118 120 123 125 126 127 128 131 134 137 141 142 145 146 147 148 149</code></pre>
</div>
<div id="时间序列抽样" class="section level4">
<h4>7.4 时间序列抽样</h4>
<p>简单随机抽样的时间序列可能不是最好的方法重新取样时间系列数据，将采用新的方法（滚动预测技术）</p>
<p><code>createTimeSlices(y, initialWindow, horizon = 1, fixedWindow = TRUE,skip = 0)</code></p>
<ul>
<li><p>initialWindow: 最初的连续值的数量在每一个训练集样本</p></li>
<li><p>horizon：连续值在测试集样本的数量</p></li>
<li><p>fixedWindow:一个逻辑:如果FALSE,训练集总是从第一个样本训练集数据分割大小会有所不同。</p></li>
</ul>
<pre class="r"><code>createTimeSlices(1:9, initialWindow=5, horizon=1, fixedWindow = FALSE)</code></pre>
<pre><code>## $train
## $train$Training5
## [1] 1 2 3 4 5
## 
## $train$Training6
## [1] 1 2 3 4 5 6
## 
## $train$Training7
## [1] 1 2 3 4 5 6 7
## 
## $train$Training8
## [1] 1 2 3 4 5 6 7 8
## 
## 
## $test
## $test$Testing5
## [1] 6
## 
## $test$Testing6
## [1] 7
## 
## $test$Testing7
## [1] 8
## 
## $test$Testing8
## [1] 9</code></pre>
<pre class="r"><code>createTimeSlices(1:9, initialWindow=5, horizon=1, fixedWindow = TRUE)</code></pre>
<pre><code>## $train
## $train$Training5
## [1] 1 2 3 4 5
## 
## $train$Training6
## [1] 2 3 4 5 6
## 
## $train$Training7
## [1] 3 4 5 6 7
## 
## $train$Training8
## [1] 4 5 6 7 8
## 
## 
## $test
## $test$Testing5
## [1] 6
## 
## $test$Testing6
## [1] 7
## 
## $test$Testing7
## [1] 8
## 
## $test$Testing8
## [1] 9</code></pre>
<pre class="r"><code>createTimeSlices(1:9, initialWindow=5, horizon=3, fixedWindow = TRUE)</code></pre>
<pre><code>## $train
## $train$Training5
## [1] 1 2 3 4 5
## 
## $train$Training6
## [1] 2 3 4 5 6
## 
## 
## $test
## $test$Testing5
## [1] 6 7 8
## 
## $test$Testing6
## [1] 7 8 9</code></pre>
<pre class="r"><code>createTimeSlices(1:9, initialWindow=5, horizon=3, fixedWindow = FALSE)</code></pre>
<pre><code>## $train
## $train$Training5
## [1] 1 2 3 4 5
## 
## $train$Training6
## [1] 1 2 3 4 5 6
## 
## 
## $test
## $test$Testing5
## [1] 6 7 8
## 
## $test$Testing6
## [1] 7 8 9</code></pre>
<pre class="r"><code>createTimeSlices(1:15, 5, 3)</code></pre>
<pre><code>## $train
## $train$Training05
## [1] 1 2 3 4 5
## 
## $train$Training06
## [1] 2 3 4 5 6
## 
## $train$Training07
## [1] 3 4 5 6 7
## 
## $train$Training08
## [1] 4 5 6 7 8
## 
## $train$Training09
## [1] 5 6 7 8 9
## 
## $train$Training10
## [1]  6  7  8  9 10
## 
## $train$Training11
## [1]  7  8  9 10 11
## 
## $train$Training12
## [1]  8  9 10 11 12
## 
## 
## $test
## $test$Testing05
## [1] 6 7 8
## 
## $test$Testing06
## [1] 7 8 9
## 
## $test$Testing07
## [1]  8  9 10
## 
## $test$Testing08
## [1]  9 10 11
## 
## $test$Testing09
## [1] 10 11 12
## 
## $test$Testing10
## [1] 11 12 13
## 
## $test$Testing11
## [1] 12 13 14
## 
## $test$Testing12
## [1] 13 14 15</code></pre>
<pre class="r"><code>createTimeSlices(1:15, 5, 3, skip = 2)</code></pre>
<pre><code>## $train
## $train$Training05
## [1] 1 2 3 4 5
## 
## $train$Training08
## [1] 4 5 6 7 8
## 
## $train$Training11
## [1]  7  8  9 10 11
## 
## 
## $test
## $test$Testing05
## [1] 6 7 8
## 
## $test$Testing08
## [1]  9 10 11
## 
## $test$Testing11
## [1] 12 13 14</code></pre>
<pre class="r"><code>createTimeSlices(1:15, 5, 3, skip = 3)</code></pre>
<pre><code>## $train
## $train$Training5
## [1] 1 2 3 4 5
## 
## $train$Training9
## [1] 5 6 7 8 9
## 
## 
## $test
## $test$Testing5
## [1] 6 7 8
## 
## $test$Testing9
## [1] 10 11 12</code></pre>
<pre class="r"><code>sessionInfo()</code></pre>
<pre><code>## R version 4.0.2 (2020-06-22)
## Platform: x86_64-apple-darwin17.0 (64-bit)
## Running under: macOS Mojave 10.14.5
## 
## Matrix products: default
## BLAS:   /Library/Frameworks/R.framework/Versions/4.0/Resources/lib/libRblas.dylib
## LAPACK: /Library/Frameworks/R.framework/Versions/4.0/Resources/lib/libRlapack.dylib
## 
## locale:
## [1] zh_CN.UTF-8/zh_CN.UTF-8/zh_CN.UTF-8/C/zh_CN.UTF-8/zh_CN.UTF-8
## 
## attached base packages:
## [1] stats     graphics  grDevices utils     datasets  methods   base     
## 
## other attached packages:
## [1] caret_6.0-86    ggplot2_3.3.2   lattice_0.20-41
## 
## loaded via a namespace (and not attached):
##  [1] tidyselect_1.1.0     xfun_0.17            purrr_0.3.4         
##  [4] reshape2_1.4.4       splines_4.0.2        colorspace_1.4-1    
##  [7] vctrs_0.3.2          generics_0.0.2       fastICA_1.2-2       
## [10] htmltools_0.5.0      stats4_4.0.2         yaml_2.2.1          
## [13] survival_3.1-12      prodlim_2019.11.13   rlang_0.4.7         
## [16] ModelMetrics_1.2.2.2 pillar_1.4.6         glue_1.4.1          
## [19] withr_2.2.0          foreach_1.5.0        lifecycle_0.2.0     
## [22] plyr_1.8.6           lava_1.6.7           stringr_1.4.0       
## [25] timeDate_3043.102    munsell_0.5.0        blogdown_0.20       
## [28] gtable_0.3.0         recipes_0.1.13       codetools_0.2-16    
## [31] evaluate_0.14        knitr_1.29           class_7.3-17        
## [34] Rcpp_1.0.5           scales_1.1.1         ipred_0.9-9         
## [37] RANN_2.6.1           digest_0.6.25        stringi_1.4.6       
## [40] bookdown_0.20        dplyr_1.0.1          grid_4.0.2          
## [43] tools_4.0.2          magrittr_1.5         tibble_3.0.3        
## [46] crayon_1.3.4         pkgconfig_2.0.3      ellipsis_0.3.1      
## [49] MASS_7.3-51.6        Matrix_1.2-18        data.table_1.13.0   
## [52] pROC_1.16.2          lubridate_1.7.9      gower_0.2.2         
## [55] rmarkdown_2.3        iterators_1.0.12     R6_2.4.1            
## [58] rpart_4.1-15         nnet_7.3-14          nlme_3.1-148        
## [61] compiler_4.0.2</code></pre>
</div>
</div>

        </section>
    </div>
    <br>
    
    




<span id="/post/2017-01-28-caret1otherfun/" class="leancloud_visitors" data-flag-title="2、caret包其他函数介绍">
  <span class="post-meta-item-text">文章总阅读量 </span>
  <span class="leancloud-visitors-count"><i class="leancloud-visitors-count"></i></span>次;
  <p></p>
</span>



    

    
    
    <button id="edit-button" class="icon-button" type="button" title="Fork and edit" aria-label="Fork and edit" aria-haspopup="true" aria-expanded="false" aria-controls="edit">
        <i class="fa fa-edit">编辑本文</i>
    </button>
    
    
    

    <br>
    <hr>
    <li style="float:left;list-style:none">
        
        <a class="previous" href="/post/2015-11-09-ga/"> 上一篇: GA包---遗传算法</a>
        
    </li>
    <li style="float:right;list-style:none">
        
        <a class="next" href="/post/2017-02-01-ggfortify1jianjie/"> 下一篇: ggfortify包简介</a>
        
    </li>
     
    
    <script src="/js/copyCode.js"></script>
    <script src="/js/tooltips.js"></script>
    
   
    <script>
    [].slice.call(document.querySelectorAll('table')).forEach(function(el) {
        var wrapper = document.createElement('div');
        wrapper.className = 'table-area';
        el.parentNode.insertBefore(wrapper, el);
        el.parentNode.removeChild(el);
        wrapper.appendChild(el);
        $("table").wrap("<div class='table-area'></div>");
    })
    </script>

    
<br>
<hr>


<!-- Global site tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-111691389-1"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag() { dataLayer.push(arguments); }
  gtag('js', new Date());

  gtag('config', 'UA-111691389-1');
</script>




      
      
      

       
      
      
      <script>
              document.getElementById("edit-button").addEventListener("click", function () {
                  var editWindow = window.open("https:\/\/github.com\/zoushucai\/blogmmm/edit/master/content/post\/2017-01-28-caret1otherfun.html");
              });</script>
      
          




<script>
  function resizeIframe(obj) {
    obj.style.height = obj.contentWindow.document.body.scrollHeight + 'px';
  } 
</script>



    </style>
    <script type="text/javascript">
    function showdiv(){
        document.getElementById("divtocTableOfContents").style.display="block";
        document.getElementById("strHref").innerHTML="目录收起-";
        document.getElementById('divTableOfContents').style.width="22%";
        document.getElementById('divTableOfContents').style.height="55%";
        document.getElementById('divTableOfContents').style.top="25%";
        document.getElementById('divTableOfContents').style.bottom="5%";
        document.getElementById("strHref").href="javascript:hidediv()";
    }
    function hidediv(){
        document.getElementById("divtocTableOfContents").style.display="none";
        document.getElementById("strHref").innerHTML="目录展开+";
        document.getElementById("strHref").href="javascript:showdiv()";
        document.getElementById('divTableOfContents').style.width="10%";
        document.getElementById('divTableOfContents').style.height="5%";
    }
    </script>
</body>

</html>
</div> 







    <script defer src="https://cdn.jsdelivr.net/npm/katex@0.12.0/dist/contrib/mathtex-script-type.min.js" integrity="sha384-LJ2FmexL77rmGm6SIpxq7y+XA6bkLzGZEgCywzKOZG/ws4va9fUVu2neMjvc3zdv" crossorigin="anonymous"></script>

    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.12.0/dist/katex.min.css">
    <script defer src="https://cdn.jsdelivr.net/npm/katex@0.12.0/dist/katex.min.js"></script>
    <script defer src="https://cdn.jsdelivr.net/npm/katex@0.12.0/dist/contrib/auto-render.min.js"></script>
    <script>
        document.addEventListener("DOMContentLoaded", function() {
            renderMathInElement(document.body, {
            delimiters: [
                            {left: "$$", right: "$$", display: true},
                            {left: "$", right: "$", display: false},
                            {left: "\\(", right: "\\)", display: false},
                            {left: "\\[", right: "\\]", display: true}
                        ]
            });
        });
    </script>













<br>
<div class="inner">
              
            
          
          
  
          
  
  <div id="vcomments"></div>
  
  <script src="//cdn1.lncld.net/static/js/3.0.4/av-min.js"></script>
  
  <script src='//unpkg.com/valine/dist/Valine.min.js'></script>
  <script type="text/javascript">
    new Valine({
        el: '#vcomments' ,
        appId: 'HfHPKPkLa0cBEDPcdBAHuqMv-gzGzoHsz',
        appKey: 'r5RJAasN8e0mB9sq6y9pEcX0',
        lang:'zh-CN',
        notify:  false , 
        verify:  false  ,
        avatar:'identicon', 
        placeholder: '说点什么吧...',
        visitor:  true 
    });
  </script>

</div>

<br>
<br>
<footer>
    <p style="float:right;margin-right: 5%;margin-top: 0%;">
        &copy; 2022 <a href="https://github.com/zoushucai">zsc</a>
      </p>
</footer>
<br>
<br>


